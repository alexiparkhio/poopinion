function cov_16fdlisa9k(){var path="C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\delete-comment.js";var hash="bb94ee37a7967d80fdf95c46984d027f27d7ace8";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\delete-comment.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:47}},"1":{start:{line:2,column:46},end:{line:2,column:71}},"2":{start:{line:3,column:43},end:{line:3,column:70}},"3":{start:{line:18,column:0},end:{line:35,column:1}},"4":{start:{line:19,column:4},end:{line:19,column:29}},"5":{start:{line:20,column:4},end:{line:20,column:42}},"6":{start:{line:21,column:4},end:{line:21,column:44}},"7":{start:{line:23,column:4},end:{line:34,column:24}},"8":{start:{line:26,column:12},end:{line:26,column:83}},"9":{start:{line:26,column:23},end:{line:26,column:83}},"10":{start:{line:27,column:12},end:{line:27,column:96}},"11":{start:{line:27,column:34},end:{line:27,column:96}},"12":{start:{line:28,column:12},end:{line:28,column:93}},"13":{start:{line:28,column:25},end:{line:28,column:93}},"14":{start:{line:29,column:12},end:{line:29,column:96}},"15":{start:{line:29,column:26},end:{line:29,column:96}},"16":{start:{line:31,column:12},end:{line:31,column:168}},"17":{start:{line:33,column:20},end:{line:33,column:56}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:18,column:17},end:{line:18,column:18}},loc:{start:{line:18,column:46},end:{line:35,column:1}},line:18},"1":{name:"(anonymous_1)",decl:{start:{line:24,column:14},end:{line:24,column:15}},loc:{start:{line:24,column:43},end:{line:32,column:9}},line:24},"2":{name:"(anonymous_2)",decl:{start:{line:33,column:14},end:{line:33,column:15}},loc:{start:{line:33,column:20},end:{line:33,column:56}},line:33},"3":{name:"(anonymous_3)",decl:{start:{line:34,column:14},end:{line:34,column:15}},loc:{start:{line:34,column:20},end:{line:34,column:23}},line:34}},branchMap:{"0":{loc:{start:{line:26,column:12},end:{line:26,column:83}},type:"if",locations:[{start:{line:26,column:12},end:{line:26,column:83}},{start:{line:26,column:12},end:{line:26,column:83}}],line:26},"1":{loc:{start:{line:27,column:12},end:{line:27,column:96}},type:"if",locations:[{start:{line:27,column:12},end:{line:27,column:96}},{start:{line:27,column:12},end:{line:27,column:96}}],line:27},"2":{loc:{start:{line:28,column:12},end:{line:28,column:93}},type:"if",locations:[{start:{line:28,column:12},end:{line:28,column:93}},{start:{line:28,column:12},end:{line:28,column:93}}],line:28},"3":{loc:{start:{line:29,column:12},end:{line:29,column:96}},type:"if",locations:[{start:{line:29,column:12},end:{line:29,column:96}},{start:{line:29,column:12},end:{line:29,column:96}}],line:29}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"bb94ee37a7967d80fdf95c46984d027f27d7ace8"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_16fdlisa9k=function(){return actualCoverage;};return actualCoverage;}cov_16fdlisa9k();const{validate}=(cov_16fdlisa9k().s[0]++,require('poopinion-utils'));const{models:{User,Toilet,Comment}}=(cov_16fdlisa9k().s[1]++,require('poopinion-data'));const{NotAllowedError,NotFoundError}=(cov_16fdlisa9k().s[2]++,require('poopinion-errors'));/**
 * Deletes a comment and removes its track from both users and toilets
 * 
 * @param {string} id user's unique id
 * @param {string} toiletId toilet's unique id
 * @param {object} commentId comment's unique id
 * 
 * @returns {Promise<string>} returns an empty Promise on a successful delete
 * 
 * @throws {NotAllowedError} if the user exists but has the property 'deactivated' as true
 * @throws {NotFoundError} if the user, toilet or comment do not exist
 */cov_16fdlisa9k().s[3]++;module.exports=(id,toiletId,commentId)=>{cov_16fdlisa9k().f[0]++;cov_16fdlisa9k().s[4]++;validate.string(id,'id');cov_16fdlisa9k().s[5]++;validate.string(toiletId,'toilet ID');cov_16fdlisa9k().s[6]++;validate.string(commentId,'comment ID');cov_16fdlisa9k().s[7]++;return Promise.all([User.findById(id),Toilet.findById(toiletId),Comment.findById(commentId)]).then(([user,toilet,comment])=>{cov_16fdlisa9k().f[1]++;cov_16fdlisa9k().s[8]++;if(!user){cov_16fdlisa9k().b[0][0]++;cov_16fdlisa9k().s[9]++;throw new NotFoundError(`user with id ${id} does not exist`);}else{cov_16fdlisa9k().b[0][1]++;}cov_16fdlisa9k().s[10]++;if(user.deactivated){cov_16fdlisa9k().b[1][0]++;cov_16fdlisa9k().s[11]++;throw new NotAllowedError(`user with id ${id} is deactivated`);}else{cov_16fdlisa9k().b[1][1]++;}cov_16fdlisa9k().s[12]++;if(!toilet){cov_16fdlisa9k().b[2][0]++;cov_16fdlisa9k().s[13]++;throw new NotFoundError(`toilet with id ${toiletId} does not exist`);}else{cov_16fdlisa9k().b[2][1]++;}cov_16fdlisa9k().s[14]++;if(!comment){cov_16fdlisa9k().b[3][0]++;cov_16fdlisa9k().s[15]++;throw new NotFoundError(`comment with id ${commentId} does not exist`);}else{cov_16fdlisa9k().b[3][1]++;}cov_16fdlisa9k().s[16]++;return Promise.all([User.findByIdAndUpdate(id,{$pull:{comments:commentId}}),Toilet.findByIdAndUpdate(toiletId,{$pull:{comments:commentId}})]);}).then(()=>{cov_16fdlisa9k().f[2]++;cov_16fdlisa9k().s[17]++;return Comment.findByIdAndRemove(commentId);}).then(()=>{cov_16fdlisa9k().f[3]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlbGV0ZS1jb21tZW50LmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlVzZXIiLCJUb2lsZXQiLCJDb21tZW50IiwiTm90QWxsb3dlZEVycm9yIiwiTm90Rm91bmRFcnJvciIsIm1vZHVsZSIsImV4cG9ydHMiLCJpZCIsInRvaWxldElkIiwiY29tbWVudElkIiwic3RyaW5nIiwiUHJvbWlzZSIsImFsbCIsImZpbmRCeUlkIiwidGhlbiIsInVzZXIiLCJ0b2lsZXQiLCJjb21tZW50IiwiZGVhY3RpdmF0ZWQiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRwdWxsIiwiY29tbWVudHMiLCJmaW5kQnlJZEFuZFJlbW92ZSJdLCJtYXBwaW5ncyI6ImcwR0FBQSxLQUFNLENBQUVBLFFBQUYsMkJBQWVDLE9BQU8sQ0FBQyxpQkFBRCxDQUF0QixDQUFOLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFRQyxNQUFSLENBQWdCQyxPQUFoQixDQUFWLDJCQUF3Q0osT0FBTyxDQUFDLGdCQUFELENBQS9DLENBQU4sQ0FDQSxLQUFNLENBQUVLLGVBQUYsQ0FBbUJDLGFBQW5CLDJCQUFxQ04sT0FBTyxDQUFDLGtCQUFELENBQTVDLENBQU4sQ0FFQTs7Ozs7Ozs7Ozs7MkJBYUFPLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUFDQyxFQUFELENBQUtDLFFBQUwsQ0FBZUMsU0FBZixHQUE2QixpREFDMUNaLFFBQVEsQ0FBQ2EsTUFBVCxDQUFnQkgsRUFBaEIsQ0FBb0IsSUFBcEIsRUFEMEMsd0JBRTFDVixRQUFRLENBQUNhLE1BQVQsQ0FBZ0JGLFFBQWhCLENBQTBCLFdBQTFCLEVBRjBDLHdCQUcxQ1gsUUFBUSxDQUFDYSxNQUFULENBQWdCRCxTQUFoQixDQUEyQixZQUEzQixFQUgwQyx3QkFLMUMsTUFBT0UsQ0FBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksQ0FBQ1osSUFBSSxDQUFDYSxRQUFMLENBQWNOLEVBQWQsQ0FBRCxDQUFvQk4sTUFBTSxDQUFDWSxRQUFQLENBQWdCTCxRQUFoQixDQUFwQixDQUErQ04sT0FBTyxDQUFDVyxRQUFSLENBQWlCSixTQUFqQixDQUEvQyxDQUFaLEVBQ0ZLLElBREUsQ0FDRyxDQUFDLENBQUNDLElBQUQsQ0FBT0MsTUFBUCxDQUFlQyxPQUFmLENBQUQsR0FBNkIsaURBRS9CLEdBQUksQ0FBQ0YsSUFBTCxDQUFXLHlEQUFNLElBQUlYLENBQUFBLGFBQUosQ0FBbUIsZ0JBQWVHLEVBQUcsaUJBQXJDLENBQU4sQ0FBNEQsQ0FBdkUsaUNBRitCLHlCQUcvQixHQUFJUSxJQUFJLENBQUNHLFdBQVQsQ0FBc0IsMERBQU0sSUFBSWYsQ0FBQUEsZUFBSixDQUFxQixnQkFBZUksRUFBRyxpQkFBdkMsQ0FBTixDQUE4RCxDQUFwRixpQ0FIK0IseUJBSS9CLEdBQUksQ0FBQ1MsTUFBTCxDQUFhLDBEQUFNLElBQUlaLENBQUFBLGFBQUosQ0FBbUIsa0JBQWlCSSxRQUFTLGlCQUE3QyxDQUFOLENBQW9FLENBQWpGLGlDQUorQix5QkFLL0IsR0FBSSxDQUFDUyxPQUFMLENBQWMsMERBQU0sSUFBSWIsQ0FBQUEsYUFBSixDQUFtQixtQkFBa0JLLFNBQVUsaUJBQS9DLENBQU4sQ0FBc0UsQ0FBcEYsaUNBTCtCLHlCQU8vQixNQUFPRSxDQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxDQUFDWixJQUFJLENBQUNtQixpQkFBTCxDQUF1QlosRUFBdkIsQ0FBMkIsQ0FBRWEsS0FBSyxDQUFFLENBQUVDLFFBQVEsQ0FBRVosU0FBWixDQUFULENBQTNCLENBQUQsQ0FBaUVSLE1BQU0sQ0FBQ2tCLGlCQUFQLENBQXlCWCxRQUF6QixDQUFtQyxDQUFFWSxLQUFLLENBQUUsQ0FBRUMsUUFBUSxDQUFFWixTQUFaLENBQVQsQ0FBbkMsQ0FBakUsQ0FBWixDQUFQLENBQ0gsQ0FURSxFQVVGSyxJQVZFLENBVUcsSUFBTSx3REFBQVosQ0FBQUEsT0FBTyxDQUFDb0IsaUJBQVIsQ0FBMEJiLFNBQTFCLEVBQW9DLENBVjdDLEVBV0ZLLElBWEUsQ0FXRyxJQUFNLHlCQUFHLENBWFosQ0FBUCxDQVlILENBakJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB2YWxpZGF0ZSB9ID0gcmVxdWlyZSgncG9vcGluaW9uLXV0aWxzJylcclxuY29uc3QgeyBtb2RlbHM6IHsgVXNlciwgVG9pbGV0LCBDb21tZW50IH0gfSA9IHJlcXVpcmUoJ3Bvb3Bpbmlvbi1kYXRhJylcclxuY29uc3QgeyBOb3RBbGxvd2VkRXJyb3IsIE5vdEZvdW5kRXJyb3IgfSA9IHJlcXVpcmUoJ3Bvb3Bpbmlvbi1lcnJvcnMnKVxyXG5cclxuLyoqXHJcbiAqIERlbGV0ZXMgYSBjb21tZW50IGFuZCByZW1vdmVzIGl0cyB0cmFjayBmcm9tIGJvdGggdXNlcnMgYW5kIHRvaWxldHNcclxuICogXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZCB1c2VyJ3MgdW5pcXVlIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB0b2lsZXRJZCB0b2lsZXQncyB1bmlxdWUgaWRcclxuICogQHBhcmFtIHtvYmplY3R9IGNvbW1lbnRJZCBjb21tZW50J3MgdW5pcXVlIGlkXHJcbiAqIFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSByZXR1cm5zIGFuIGVtcHR5IFByb21pc2Ugb24gYSBzdWNjZXNzZnVsIGRlbGV0ZVxyXG4gKiBcclxuICogQHRocm93cyB7Tm90QWxsb3dlZEVycm9yfSBpZiB0aGUgdXNlciBleGlzdHMgYnV0IGhhcyB0aGUgcHJvcGVydHkgJ2RlYWN0aXZhdGVkJyBhcyB0cnVlXHJcbiAqIEB0aHJvd3Mge05vdEZvdW5kRXJyb3J9IGlmIHRoZSB1c2VyLCB0b2lsZXQgb3IgY29tbWVudCBkbyBub3QgZXhpc3RcclxuICovXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IChpZCwgdG9pbGV0SWQsIGNvbW1lbnRJZCkgPT4ge1xyXG4gICAgdmFsaWRhdGUuc3RyaW5nKGlkLCAnaWQnKVxyXG4gICAgdmFsaWRhdGUuc3RyaW5nKHRvaWxldElkLCAndG9pbGV0IElEJylcclxuICAgIHZhbGlkYXRlLnN0cmluZyhjb21tZW50SWQsICdjb21tZW50IElEJylcclxuXHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1VzZXIuZmluZEJ5SWQoaWQpLCBUb2lsZXQuZmluZEJ5SWQodG9pbGV0SWQpLCBDb21tZW50LmZpbmRCeUlkKGNvbW1lbnRJZCldKVxyXG4gICAgICAgIC50aGVuKChbdXNlciwgdG9pbGV0LCBjb21tZW50XSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcihgdXNlciB3aXRoIGlkICR7aWR9IGRvZXMgbm90IGV4aXN0YClcclxuICAgICAgICAgICAgaWYgKHVzZXIuZGVhY3RpdmF0ZWQpIHRocm93IG5ldyBOb3RBbGxvd2VkRXJyb3IoYHVzZXIgd2l0aCBpZCAke2lkfSBpcyBkZWFjdGl2YXRlZGApXHJcbiAgICAgICAgICAgIGlmICghdG9pbGV0KSB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcihgdG9pbGV0IHdpdGggaWQgJHt0b2lsZXRJZH0gZG9lcyBub3QgZXhpc3RgKVxyXG4gICAgICAgICAgICBpZiAoIWNvbW1lbnQpIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKGBjb21tZW50IHdpdGggaWQgJHtjb21tZW50SWR9IGRvZXMgbm90IGV4aXN0YClcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbVXNlci5maW5kQnlJZEFuZFVwZGF0ZShpZCwgeyAkcHVsbDogeyBjb21tZW50czogY29tbWVudElkIH0gfSksIFRvaWxldC5maW5kQnlJZEFuZFVwZGF0ZSh0b2lsZXRJZCwgeyAkcHVsbDogeyBjb21tZW50czogY29tbWVudElkIH0gfSldKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKCkgPT4gQ29tbWVudC5maW5kQnlJZEFuZFJlbW92ZShjb21tZW50SWQpKVxyXG4gICAgICAgIC50aGVuKCgpID0+IHsgfSlcclxufSJdfQ==