function cov_1s1rzy4yt(){var path="C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\retrieve-fav-toilets.js";var hash="bca118d3e1e4d19fe1d23de2357a2c55e6d6eafa";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\retrieve-fav-toilets.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:47}},"1":{start:{line:2,column:37},end:{line:2,column:62}},"2":{start:{line:3,column:43},end:{line:3,column:70}},"3":{start:{line:16,column:0},end:{line:44,column:1}},"4":{start:{line:17,column:4},end:{line:17,column:29}},"5":{start:{line:19,column:4},end:{line:43,column:10}},"6":{start:{line:21,column:12},end:{line:21,column:83}},"7":{start:{line:21,column:23},end:{line:21,column:83}},"8":{start:{line:22,column:12},end:{line:22,column:96}},"9":{start:{line:22,column:34},end:{line:22,column:96}},"10":{start:{line:24,column:12},end:{line:42,column:18}},"11":{start:{line:26,column:20},end:{line:39,column:22}},"12":{start:{line:27,column:24},end:{line:27,column:57}},"13":{start:{line:28,column:24},end:{line:28,column:41}},"14":{start:{line:29,column:24},end:{line:29,column:41}},"15":{start:{line:31,column:24},end:{line:35,column:26}},"16":{start:{line:32,column:28},end:{line:32,column:63}},"17":{start:{line:33,column:28},end:{line:33,column:46}},"18":{start:{line:34,column:28},end:{line:34,column:46}},"19":{start:{line:37,column:24},end:{line:37,column:66}},"20":{start:{line:38,column:24},end:{line:38,column:51}},"21":{start:{line:41,column:20},end:{line:41,column:34}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:16,column:17},end:{line:16,column:18}},loc:{start:{line:16,column:23},end:{line:44,column:1}},line:16},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:14},end:{line:20,column:15}},loc:{start:{line:20,column:22},end:{line:43,column:9}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:25,column:22},end:{line:25,column:23}},loc:{start:{line:25,column:33},end:{line:42,column:17}},line:25},"3":{name:"(anonymous_3)",decl:{start:{line:26,column:36},end:{line:26,column:37}},loc:{start:{line:26,column:46},end:{line:39,column:21}},line:26},"4":{name:"(anonymous_4)",decl:{start:{line:31,column:48},end:{line:31,column:49}},loc:{start:{line:31,column:59},end:{line:35,column:25}},line:31}},branchMap:{"0":{loc:{start:{line:21,column:12},end:{line:21,column:83}},type:"if",locations:[{start:{line:21,column:12},end:{line:21,column:83}},{start:{line:21,column:12},end:{line:21,column:83}}],line:21},"1":{loc:{start:{line:22,column:12},end:{line:22,column:96}},type:"if",locations:[{start:{line:22,column:12},end:{line:22,column:96}},{start:{line:22,column:12},end:{line:22,column:96}}],line:22}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"bca118d3e1e4d19fe1d23de2357a2c55e6d6eafa"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1s1rzy4yt=function(){return actualCoverage;};return actualCoverage;}cov_1s1rzy4yt();const{validate}=(cov_1s1rzy4yt().s[0]++,require('poopinion-utils'));const{models:{User,Toilet}}=(cov_1s1rzy4yt().s[1]++,require('poopinion-data'));const{NotFoundError,NotAllowedError}=(cov_1s1rzy4yt().s[2]++,require('poopinion-errors'));/**
 * Retrieves all favorite toilet posts that are included on the user
 * 
 * @param {string} id user's unique ID
 * 
 * @returns {Array} returns an array of all found results
 * 
 * @throws {NotFoundError} if the user does not exist
 * @throws {NotAllowedError} if the user exists but has the property 'deactivated' as true
 */cov_1s1rzy4yt().s[3]++;module.exports=id=>{cov_1s1rzy4yt().f[0]++;cov_1s1rzy4yt().s[4]++;validate.string(id,'id');cov_1s1rzy4yt().s[5]++;return User.findById(id).then(user=>{cov_1s1rzy4yt().f[1]++;cov_1s1rzy4yt().s[6]++;if(!user){cov_1s1rzy4yt().b[0][0]++;cov_1s1rzy4yt().s[7]++;throw new NotFoundError(`user with id ${id} does not exist`);}else{cov_1s1rzy4yt().b[0][1]++;}cov_1s1rzy4yt().s[8]++;if(user.deactivated){cov_1s1rzy4yt().b[1][0]++;cov_1s1rzy4yt().s[9]++;throw new NotAllowedError(`user with id ${id} is deactivated`);}else{cov_1s1rzy4yt().b[1][1]++;}cov_1s1rzy4yt().s[10]++;return Toilet.find({isFavedBy:id}).populate('comments').populate('publisher','name surname').lean().then(toilets=>{cov_1s1rzy4yt().f[2]++;cov_1s1rzy4yt().s[11]++;toilets.forEach(toilet=>{cov_1s1rzy4yt().f[3]++;cov_1s1rzy4yt().s[12]++;toilet.id=toilet._id.toString();cov_1s1rzy4yt().s[13]++;delete toilet._id;cov_1s1rzy4yt().s[14]++;delete toilet.__v;cov_1s1rzy4yt().s[15]++;toilet.comments.forEach(comment=>{cov_1s1rzy4yt().f[4]++;cov_1s1rzy4yt().s[16]++;comment.id=comment._id.toString();cov_1s1rzy4yt().s[17]++;delete comment._id;cov_1s1rzy4yt().s[18]++;delete comment.__v;});cov_1s1rzy4yt().s[19]++;toilet.publisher.id=toilet.publisher._id;cov_1s1rzy4yt().s[20]++;delete toilet.publisher._id;});cov_1s1rzy4yt().s[21]++;return toilets;});});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJldHJpZXZlLWZhdi10b2lsZXRzLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlVzZXIiLCJUb2lsZXQiLCJOb3RGb3VuZEVycm9yIiwiTm90QWxsb3dlZEVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsImlkIiwic3RyaW5nIiwiZmluZEJ5SWQiLCJ0aGVuIiwidXNlciIsImRlYWN0aXZhdGVkIiwiZmluZCIsImlzRmF2ZWRCeSIsInBvcHVsYXRlIiwibGVhbiIsInRvaWxldHMiLCJmb3JFYWNoIiwidG9pbGV0IiwiX2lkIiwidG9TdHJpbmciLCJfX3YiLCJjb21tZW50cyIsImNvbW1lbnQiLCJwdWJsaXNoZXIiXSwibWFwcGluZ3MiOiJ3MEdBQUEsS0FBTSxDQUFFQSxRQUFGLDBCQUFlQyxPQUFPLENBQUMsaUJBQUQsQ0FBdEIsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBUUMsTUFBUixDQUFWLDBCQUErQkgsT0FBTyxDQUFDLGdCQUFELENBQXRDLENBQU4sQ0FDQSxLQUFNLENBQUVJLGFBQUYsQ0FBaUJDLGVBQWpCLDBCQUFxQ0wsT0FBTyxDQUFDLGtCQUFELENBQTVDLENBQU4sQ0FFQTs7Ozs7Ozs7OzBCQVdBTSxNQUFNLENBQUNDLE9BQVAsQ0FBaUJDLEVBQUUsRUFBSSwrQ0FDbkJULFFBQVEsQ0FBQ1UsTUFBVCxDQUFnQkQsRUFBaEIsQ0FBb0IsSUFBcEIsRUFEbUIsdUJBR25CLE1BQU9OLENBQUFBLElBQUksQ0FBQ1EsUUFBTCxDQUFjRixFQUFkLEVBQ0ZHLElBREUsQ0FDR0MsSUFBSSxFQUFJLCtDQUNWLEdBQUksQ0FBQ0EsSUFBTCxDQUFXLHVEQUFNLElBQUlSLENBQUFBLGFBQUosQ0FBbUIsZ0JBQWVJLEVBQUcsaUJBQXJDLENBQU4sQ0FBNEQsQ0FBdkUsZ0NBRFUsdUJBRVYsR0FBSUksSUFBSSxDQUFDQyxXQUFULENBQXNCLHVEQUFNLElBQUlSLENBQUFBLGVBQUosQ0FBcUIsZ0JBQWVHLEVBQUcsaUJBQXZDLENBQU4sQ0FBOEQsQ0FBcEYsZ0NBRlUsd0JBSVYsTUFBT0wsQ0FBQUEsTUFBTSxDQUFDVyxJQUFQLENBQVksQ0FBRUMsU0FBUyxDQUFFUCxFQUFiLENBQVosRUFBK0JRLFFBQS9CLENBQXdDLFVBQXhDLEVBQW9EQSxRQUFwRCxDQUE2RCxXQUE3RCxDQUEwRSxjQUExRSxFQUEwRkMsSUFBMUYsR0FDRk4sSUFERSxDQUNHTyxPQUFPLEVBQUksZ0RBQ2JBLE9BQU8sQ0FBQ0MsT0FBUixDQUFnQkMsTUFBTSxFQUFJLGdEQUN0QkEsTUFBTSxDQUFDWixFQUFQLENBQVlZLE1BQU0sQ0FBQ0MsR0FBUCxDQUFXQyxRQUFYLEVBQVosQ0FEc0Isd0JBRXRCLE1BQU9GLENBQUFBLE1BQU0sQ0FBQ0MsR0FBZCxDQUZzQix3QkFHdEIsTUFBT0QsQ0FBQUEsTUFBTSxDQUFDRyxHQUFkLENBSHNCLHdCQUt0QkgsTUFBTSxDQUFDSSxRQUFQLENBQWdCTCxPQUFoQixDQUF3Qk0sT0FBTyxFQUFJLGdEQUMvQkEsT0FBTyxDQUFDakIsRUFBUixDQUFhaUIsT0FBTyxDQUFDSixHQUFSLENBQVlDLFFBQVosRUFBYixDQUQrQix3QkFFL0IsTUFBT0csQ0FBQUEsT0FBTyxDQUFDSixHQUFmLENBRitCLHdCQUcvQixNQUFPSSxDQUFBQSxPQUFPLENBQUNGLEdBQWYsQ0FDSCxDQUpELEVBTHNCLHdCQVd0QkgsTUFBTSxDQUFDTSxTQUFQLENBQWlCbEIsRUFBakIsQ0FBc0JZLE1BQU0sQ0FBQ00sU0FBUCxDQUFpQkwsR0FBdkMsQ0FYc0Isd0JBWXRCLE1BQU9ELENBQUFBLE1BQU0sQ0FBQ00sU0FBUCxDQUFpQkwsR0FBeEIsQ0FDSCxDQWJELEVBRGEsd0JBZ0JiLE1BQU9ILENBQUFBLE9BQVAsQ0FDSCxDQWxCRSxDQUFQLENBbUJILENBeEJFLENBQVAsQ0F5QkgsQ0E1QkQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHZhbGlkYXRlIH0gPSByZXF1aXJlKCdwb29waW5pb24tdXRpbHMnKVxyXG5jb25zdCB7IG1vZGVsczogeyBVc2VyLCBUb2lsZXQgfSB9ID0gcmVxdWlyZSgncG9vcGluaW9uLWRhdGEnKVxyXG5jb25zdCB7IE5vdEZvdW5kRXJyb3IsIE5vdEFsbG93ZWRFcnJvciB9ID0gcmVxdWlyZSgncG9vcGluaW9uLWVycm9ycycpXHJcblxyXG4vKipcclxuICogUmV0cmlldmVzIGFsbCBmYXZvcml0ZSB0b2lsZXQgcG9zdHMgdGhhdCBhcmUgaW5jbHVkZWQgb24gdGhlIHVzZXJcclxuICogXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZCB1c2VyJ3MgdW5pcXVlIElEXHJcbiAqIFxyXG4gKiBAcmV0dXJucyB7QXJyYXl9IHJldHVybnMgYW4gYXJyYXkgb2YgYWxsIGZvdW5kIHJlc3VsdHNcclxuICogXHJcbiAqIEB0aHJvd3Mge05vdEZvdW5kRXJyb3J9IGlmIHRoZSB1c2VyIGRvZXMgbm90IGV4aXN0XHJcbiAqIEB0aHJvd3Mge05vdEFsbG93ZWRFcnJvcn0gaWYgdGhlIHVzZXIgZXhpc3RzIGJ1dCBoYXMgdGhlIHByb3BlcnR5ICdkZWFjdGl2YXRlZCcgYXMgdHJ1ZVxyXG4gKi9cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gaWQgPT4ge1xyXG4gICAgdmFsaWRhdGUuc3RyaW5nKGlkLCAnaWQnKVxyXG5cclxuICAgIHJldHVybiBVc2VyLmZpbmRCeUlkKGlkKVxyXG4gICAgICAgIC50aGVuKHVzZXIgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKGB1c2VyIHdpdGggaWQgJHtpZH0gZG9lcyBub3QgZXhpc3RgKVxyXG4gICAgICAgICAgICBpZiAodXNlci5kZWFjdGl2YXRlZCkgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvcihgdXNlciB3aXRoIGlkICR7aWR9IGlzIGRlYWN0aXZhdGVkYClcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBUb2lsZXQuZmluZCh7IGlzRmF2ZWRCeTogaWQgfSkucG9wdWxhdGUoJ2NvbW1lbnRzJykucG9wdWxhdGUoJ3B1Ymxpc2hlcicsICduYW1lIHN1cm5hbWUnKS5sZWFuKClcclxuICAgICAgICAgICAgICAgIC50aGVuKHRvaWxldHMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvaWxldHMuZm9yRWFjaCh0b2lsZXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b2lsZXQuaWQgPSB0b2lsZXQuX2lkLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRvaWxldC5faWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRvaWxldC5fX3ZcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvaWxldC5jb21tZW50cy5mb3JFYWNoKGNvbW1lbnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudC5pZCA9IGNvbW1lbnQuX2lkLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb21tZW50Ll9pZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbW1lbnQuX192XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b2lsZXQucHVibGlzaGVyLmlkID0gdG9pbGV0LnB1Ymxpc2hlci5faWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRvaWxldC5wdWJsaXNoZXIuX2lkXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvaWxldHNcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxufSJdfQ==