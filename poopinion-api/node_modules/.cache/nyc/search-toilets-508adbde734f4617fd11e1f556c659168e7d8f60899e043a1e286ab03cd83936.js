function cov_15b71vhx6v(){var path="C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\search-toilets.js";var hash="8a090c70514ff692e9782bc8fa24945e6c1a3368";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\search-toilets.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:47}},"1":{start:{line:2,column:31},end:{line:2,column:56}},"2":{start:{line:15,column:0},end:{line:49,column:1}},"3":{start:{line:16,column:4},end:{line:16,column:35}},"4":{start:{line:18,column:4},end:{line:48,column:10}},"5":{start:{line:20,column:12},end:{line:47,column:28}},"6":{start:{line:21,column:16},end:{line:42,column:18}},"7":{start:{line:22,column:20},end:{line:22,column:36}},"8":{start:{line:24,column:20},end:{line:24,column:53}},"9":{start:{line:25,column:20},end:{line:25,column:37}},"10":{start:{line:26,column:20},end:{line:26,column:37}},"11":{start:{line:28,column:20},end:{line:31,column:21}},"12":{start:{line:29,column:24},end:{line:29,column:77}},"13":{start:{line:30,column:24},end:{line:30,column:51}},"14":{start:{line:33,column:20},end:{line:39,column:22}},"15":{start:{line:34,column:24},end:{line:34,column:59}},"16":{start:{line:35,column:24},end:{line:35,column:42}},"17":{start:{line:36,column:24},end:{line:36,column:42}},"18":{start:{line:38,column:24},end:{line:38,column:142}},"19":{start:{line:41,column:20},end:{line:41,column:97}},"20":{start:{line:44,column:16},end:{line:46,column:18}},"21":{start:{line:45,column:20},end:{line:45,column:44}},"22":{start:{line:47,column:19},end:{line:47,column:28}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:15,column:17},end:{line:15,column:18}},loc:{start:{line:15,column:26},end:{line:49,column:1}},line:15},"1":{name:"(anonymous_1)",decl:{start:{line:19,column:14},end:{line:19,column:15}},loc:{start:{line:19,column:25},end:{line:48,column:9}},line:19},"2":{name:"(anonymous_2)",decl:{start:{line:21,column:32},end:{line:21,column:33}},loc:{start:{line:21,column:42},end:{line:42,column:17}},line:21},"3":{name:"(anonymous_3)",decl:{start:{line:33,column:74},end:{line:33,column:75}},loc:{start:{line:33,column:85},end:{line:39,column:21}},line:33},"4":{name:"(anonymous_4)",decl:{start:{line:44,column:36},end:{line:44,column:37}},loc:{start:{line:44,column:52},end:{line:46,column:17}},line:44}},branchMap:{"0":{loc:{start:{line:20,column:12},end:{line:47,column:28}},type:"if",locations:[{start:{line:20,column:12},end:{line:47,column:28}},{start:{line:20,column:12},end:{line:47,column:28}}],line:20},"1":{loc:{start:{line:28,column:20},end:{line:31,column:21}},type:"if",locations:[{start:{line:28,column:20},end:{line:31,column:21}},{start:{line:28,column:20},end:{line:31,column:21}}],line:28},"2":{loc:{start:{line:33,column:20},end:{line:39,column:22}},type:"binary-expr",locations:[{start:{line:33,column:20},end:{line:33,column:46}},{start:{line:33,column:50},end:{line:39,column:22}}],line:33}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8a090c70514ff692e9782bc8fa24945e6c1a3368"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_15b71vhx6v=function(){return actualCoverage;};return actualCoverage;}cov_15b71vhx6v();const{validate}=(cov_15b71vhx6v().s[0]++,require('poopinion-utils'));const{models:{Toilet}}=(cov_15b71vhx6v().s[1]++,require('poopinion-data'));/**
 * Retrieves all toilet posts that matches the specified query criteria
 * 
 * @param {string} query query's criteria
 * 
 * @returns {Array} returns an array of all found results
 * 
 * @throws {NotAllowedError} if the user exists but has the property 'deactivated' as true
 * @throws {NotFoundError} if the user does not exist
 */cov_15b71vhx6v().s[2]++;module.exports=query=>{cov_15b71vhx6v().f[0]++;cov_15b71vhx6v().s[3]++;validate.string(query,'query');cov_15b71vhx6v().s[4]++;return Toilet.find({"place":{$regex:`.*${query}.*`}}).populate('publisher','name surname').populate('comments').lean().then(toilets=>{cov_15b71vhx6v().f[1]++;cov_15b71vhx6v().s[5]++;if(toilets.length>0){cov_15b71vhx6v().b[0][0]++;cov_15b71vhx6v().s[6]++;toilets.forEach(toilet=>{cov_15b71vhx6v().f[2]++;cov_15b71vhx6v().s[7]++;toilet.score=0;cov_15b71vhx6v().s[8]++;toilet.id=toilet._id.toString();cov_15b71vhx6v().s[9]++;delete toilet._id;cov_15b71vhx6v().s[10]++;delete toilet.__v;cov_15b71vhx6v().s[11]++;if(typeof toilet.publisher._id!=='undefined'){cov_15b71vhx6v().b[1][0]++;cov_15b71vhx6v().s[12]++;toilet.publisher.id=toilet.publisher._id.toString();cov_15b71vhx6v().s[13]++;delete toilet.publisher._id;}else{cov_15b71vhx6v().b[1][1]++;}cov_15b71vhx6v().s[14]++;(cov_15b71vhx6v().b[2][0]++,toilet.comments.length>0)&&(cov_15b71vhx6v().b[2][1]++,toilet.comments.forEach(comment=>{cov_15b71vhx6v().f[3]++;cov_15b71vhx6v().s[15]++;comment.id=comment._id.toString();cov_15b71vhx6v().s[16]++;delete comment._id;cov_15b71vhx6v().s[17]++;delete comment.__v;cov_15b71vhx6v().s[18]++;toilet.score+=(comment.rating.overallRating+comment.rating.cleanness*0.5+comment.rating.looks*0.5)/2;}));cov_15b71vhx6v().s[19]++;toilet.score=parseFloat((toilet.score/toilet.comments.length).toFixed(2));});cov_15b71vhx6v().s[20]++;return toilets.sort(function(a,b){cov_15b71vhx6v().f[4]++;cov_15b71vhx6v().s[21]++;return b.score-a.score;});}else{cov_15b71vhx6v().b[0][1]++;cov_15b71vhx6v().s[22]++;return[];}});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlYXJjaC10b2lsZXRzLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlRvaWxldCIsIm1vZHVsZSIsImV4cG9ydHMiLCJxdWVyeSIsInN0cmluZyIsImZpbmQiLCIkcmVnZXgiLCJwb3B1bGF0ZSIsImxlYW4iLCJ0aGVuIiwidG9pbGV0cyIsImxlbmd0aCIsImZvckVhY2giLCJ0b2lsZXQiLCJzY29yZSIsImlkIiwiX2lkIiwidG9TdHJpbmciLCJfX3YiLCJwdWJsaXNoZXIiLCJjb21tZW50cyIsImNvbW1lbnQiLCJyYXRpbmciLCJvdmVyYWxsUmF0aW5nIiwiY2xlYW5uZXNzIiwibG9va3MiLCJwYXJzZUZsb2F0IiwidG9GaXhlZCIsInNvcnQiLCJhIiwiYiJdLCJtYXBwaW5ncyI6InlsSEFBQSxLQUFNLENBQUVBLFFBQUYsMkJBQWVDLE9BQU8sQ0FBQyxpQkFBRCxDQUF0QixDQUFOLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsTUFBRixDQUFWLDJCQUF5QkYsT0FBTyxDQUFDLGdCQUFELENBQWhDLENBQU4sQ0FFQTs7Ozs7Ozs7OzJCQVdBRyxNQUFNLENBQUNDLE9BQVAsQ0FBaUJDLEtBQUssRUFBSSxpREFDdEJOLFFBQVEsQ0FBQ08sTUFBVCxDQUFnQkQsS0FBaEIsQ0FBdUIsT0FBdkIsRUFEc0Isd0JBR3RCLE1BQU9ILENBQUFBLE1BQU0sQ0FBQ0ssSUFBUCxDQUFZLENBQUUsUUFBUyxDQUFFQyxNQUFNLENBQUcsS0FBSUgsS0FBTSxJQUFyQixDQUFYLENBQVosRUFBcURJLFFBQXJELENBQThELFdBQTlELENBQTJFLGNBQTNFLEVBQTJGQSxRQUEzRixDQUFvRyxVQUFwRyxFQUFnSEMsSUFBaEgsR0FDRkMsSUFERSxDQUNHQyxPQUFPLEVBQUksaURBQ2IsR0FBSUEsT0FBTyxDQUFDQyxNQUFSLENBQWlCLENBQXJCLENBQXdCLG9EQUNwQkQsT0FBTyxDQUFDRSxPQUFSLENBQWdCQyxNQUFNLEVBQUksaURBQ3RCQSxNQUFNLENBQUNDLEtBQVAsQ0FBZSxDQUFmLENBRHNCLHdCQUd0QkQsTUFBTSxDQUFDRSxFQUFQLENBQVlGLE1BQU0sQ0FBQ0csR0FBUCxDQUFXQyxRQUFYLEVBQVosQ0FIc0Isd0JBSXRCLE1BQU9KLENBQUFBLE1BQU0sQ0FBQ0csR0FBZCxDQUpzQix5QkFLdEIsTUFBT0gsQ0FBQUEsTUFBTSxDQUFDSyxHQUFkLENBTHNCLHlCQU90QixHQUFJLE1BQU9MLENBQUFBLE1BQU0sQ0FBQ00sU0FBUCxDQUFpQkgsR0FBeEIsR0FBZ0MsV0FBcEMsQ0FBaUQscURBQzdDSCxNQUFNLENBQUNNLFNBQVAsQ0FBaUJKLEVBQWpCLENBQXNCRixNQUFNLENBQUNNLFNBQVAsQ0FBaUJILEdBQWpCLENBQXFCQyxRQUFyQixFQUF0QixDQUQ2Qyx5QkFFN0MsTUFBT0osQ0FBQUEsTUFBTSxDQUFDTSxTQUFQLENBQWlCSCxHQUF4QixDQUNILENBSEQsaUNBUHNCLHlCQVl0Qiw0QkFBQUgsTUFBTSxDQUFDTyxRQUFQLENBQWdCVCxNQUFoQixDQUF5QixDQUF6QiwrQkFBOEJFLE1BQU0sQ0FBQ08sUUFBUCxDQUFnQlIsT0FBaEIsQ0FBd0JTLE9BQU8sRUFBSSxrREFDN0RBLE9BQU8sQ0FBQ04sRUFBUixDQUFhTSxPQUFPLENBQUNMLEdBQVIsQ0FBWUMsUUFBWixFQUFiLENBRDZELHlCQUU3RCxNQUFPSSxDQUFBQSxPQUFPLENBQUNMLEdBQWYsQ0FGNkQseUJBRzdELE1BQU9LLENBQUFBLE9BQU8sQ0FBQ0gsR0FBZixDQUg2RCx5QkFLN0RMLE1BQU0sQ0FBQ0MsS0FBUCxFQUFpQixDQUFDTyxPQUFPLENBQUNDLE1BQVIsQ0FBZUMsYUFBZixDQUFnQ0YsT0FBTyxDQUFDQyxNQUFSLENBQWVFLFNBQWYsQ0FBMkIsR0FBM0QsQ0FBbUVILE9BQU8sQ0FBQ0MsTUFBUixDQUFlRyxLQUFmLENBQXVCLEdBQTNGLEVBQW1HLENBQXBILENBQ0gsQ0FONkIsQ0FBOUIsRUFac0IseUJBb0J0QlosTUFBTSxDQUFDQyxLQUFQLENBQWVZLFVBQVUsQ0FBQyxDQUFDYixNQUFNLENBQUNDLEtBQVAsQ0FBZUQsTUFBTSxDQUFDTyxRQUFQLENBQWdCVCxNQUFoQyxFQUF3Q2dCLE9BQXhDLENBQWdELENBQWhELENBQUQsQ0FBekIsQ0FDSCxDQXJCRCxFQURvQix5QkF3QnBCLE1BQU9qQixDQUFBQSxPQUFPLENBQUNrQixJQUFSLENBQWEsU0FBVUMsQ0FBVixDQUFhQyxDQUFiLENBQWdCLGtEQUNoQyxNQUFPQSxDQUFBQSxDQUFDLENBQUNoQixLQUFGLENBQVVlLENBQUMsQ0FBQ2YsS0FBbkIsQ0FDSCxDQUZNLENBQVAsQ0FHSCxDQTNCRCxJQTJCTywyREFBTyxFQUFQLENBQVMsQ0FDbkIsQ0E5QkUsQ0FBUCxDQStCSCxDQWxDRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgdmFsaWRhdGUgfSA9IHJlcXVpcmUoJ3Bvb3Bpbmlvbi11dGlscycpXHJcbmNvbnN0IHsgbW9kZWxzOiB7IFRvaWxldCB9IH0gPSByZXF1aXJlKCdwb29waW5pb24tZGF0YScpXHJcblxyXG4vKipcclxuICogUmV0cmlldmVzIGFsbCB0b2lsZXQgcG9zdHMgdGhhdCBtYXRjaGVzIHRoZSBzcGVjaWZpZWQgcXVlcnkgY3JpdGVyaWFcclxuICogXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeSBxdWVyeSdzIGNyaXRlcmlhXHJcbiAqIFxyXG4gKiBAcmV0dXJucyB7QXJyYXl9IHJldHVybnMgYW4gYXJyYXkgb2YgYWxsIGZvdW5kIHJlc3VsdHNcclxuICogXHJcbiAqIEB0aHJvd3Mge05vdEFsbG93ZWRFcnJvcn0gaWYgdGhlIHVzZXIgZXhpc3RzIGJ1dCBoYXMgdGhlIHByb3BlcnR5ICdkZWFjdGl2YXRlZCcgYXMgdHJ1ZVxyXG4gKiBAdGhyb3dzIHtOb3RGb3VuZEVycm9yfSBpZiB0aGUgdXNlciBkb2VzIG5vdCBleGlzdFxyXG4gKi9cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcXVlcnkgPT4ge1xyXG4gICAgdmFsaWRhdGUuc3RyaW5nKHF1ZXJ5LCAncXVlcnknKVxyXG5cclxuICAgIHJldHVybiBUb2lsZXQuZmluZCh7IFwicGxhY2VcIjogeyAkcmVnZXg6IGAuKiR7cXVlcnl9LipgIH0gfSkucG9wdWxhdGUoJ3B1Ymxpc2hlcicsICduYW1lIHN1cm5hbWUnKS5wb3B1bGF0ZSgnY29tbWVudHMnKS5sZWFuKClcclxuICAgICAgICAudGhlbih0b2lsZXRzID0+IHtcclxuICAgICAgICAgICAgaWYgKHRvaWxldHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdG9pbGV0cy5mb3JFYWNoKHRvaWxldCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9pbGV0LnNjb3JlID0gMFxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0b2lsZXQuaWQgPSB0b2lsZXQuX2lkLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdG9pbGV0Ll9pZFxyXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0b2lsZXQuX192XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdG9pbGV0LnB1Ymxpc2hlci5faWQgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvaWxldC5wdWJsaXNoZXIuaWQgPSB0b2lsZXQucHVibGlzaGVyLl9pZC50b1N0cmluZygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0b2lsZXQucHVibGlzaGVyLl9pZFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdG9pbGV0LmNvbW1lbnRzLmxlbmd0aCA+IDAgJiYgdG9pbGV0LmNvbW1lbnRzLmZvckVhY2goY29tbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQuaWQgPSBjb21tZW50Ll9pZC50b1N0cmluZygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb21tZW50Ll9pZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29tbWVudC5fX3ZcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvaWxldC5zY29yZSArPSAoKGNvbW1lbnQucmF0aW5nLm92ZXJhbGxSYXRpbmcgKyAoY29tbWVudC5yYXRpbmcuY2xlYW5uZXNzICogMC41KSArIChjb21tZW50LnJhdGluZy5sb29rcyAqIDAuNSkpIC8gMilcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0b2lsZXQuc2NvcmUgPSBwYXJzZUZsb2F0KCh0b2lsZXQuc2NvcmUgLyB0b2lsZXQuY29tbWVudHMubGVuZ3RoKS50b0ZpeGVkKDIpKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdG9pbGV0cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9IGVsc2UgcmV0dXJuIFtdIFxyXG4gICAgICAgIH0pXHJcbn0iXX0=