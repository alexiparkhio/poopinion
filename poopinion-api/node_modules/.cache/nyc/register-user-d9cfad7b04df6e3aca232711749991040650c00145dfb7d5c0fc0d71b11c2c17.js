function cov_18dwzrjbc7(){var path="C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\register-user.js";var hash="c40647e49e5b048da8c29139ae44fccda8f8d33b";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\register-user.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:47}},"1":{start:{line:2,column:29},end:{line:2,column:54}},"2":{start:{line:3,column:28},end:{line:3,column:55}},"3":{start:{line:4,column:15},end:{line:4,column:34}},"4":{start:{line:21,column:0},end:{line:44,column:1}},"5":{start:{line:22,column:4},end:{line:22,column:33}},"6":{start:{line:23,column:4},end:{line:23,column:39}},"7":{start:{line:24,column:4},end:{line:24,column:35}},"8":{start:{line:25,column:4},end:{line:25,column:37}},"9":{start:{line:26,column:4},end:{line:26,column:37}},"10":{start:{line:27,column:4},end:{line:27,column:27}},"11":{start:{line:28,column:4},end:{line:28,column:25}},"12":{start:{line:29,column:4},end:{line:29,column:41}},"13":{start:{line:31,column:4},end:{line:42,column:24}},"14":{start:{line:33,column:12},end:{line:33,column:90}},"15":{start:{line:33,column:22},end:{line:33,column:90}},"16":{start:{line:35,column:12},end:{line:35,column:44}},"17":{start:{line:38,column:12},end:{line:38,column:108}},"18":{start:{line:40,column:12},end:{line:40,column:30}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:21,column:17},end:{line:21,column:18}},loc:{start:{line:21,column:66},end:{line:44,column:1}},line:21},"1":{name:"(anonymous_1)",decl:{start:{line:32,column:14},end:{line:32,column:15}},loc:{start:{line:32,column:22},end:{line:36,column:9}},line:32},"2":{name:"(anonymous_2)",decl:{start:{line:37,column:14},end:{line:37,column:15}},loc:{start:{line:37,column:26},end:{line:41,column:9}},line:37},"3":{name:"(anonymous_3)",decl:{start:{line:42,column:14},end:{line:42,column:15}},loc:{start:{line:42,column:20},end:{line:42,column:23}},line:42}},branchMap:{"0":{loc:{start:{line:33,column:12},end:{line:33,column:90}},type:"if",locations:[{start:{line:33,column:12},end:{line:33,column:90}},{start:{line:33,column:12},end:{line:33,column:90}}],line:33}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"c40647e49e5b048da8c29139ae44fccda8f8d33b"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_18dwzrjbc7=function(){return actualCoverage;};return actualCoverage;}cov_18dwzrjbc7();const{validate}=(cov_18dwzrjbc7().s[0]++,require('poopinion-utils'));const{models:{User}}=(cov_18dwzrjbc7().s[1]++,require('poopinion-data'));const{NotAllowedError}=(cov_18dwzrjbc7().s[2]++,require('poopinion-errors'));const bcrypt=(cov_18dwzrjbc7().s[3]++,require('bcryptjs'));/**
 * Registers a new user on the database
 * 
 * @param {string} name user's name
 * @param {string} surname user's surname
 * @param {string} email user's unique e-mail
 * @param {string} password user's password, with further encryptation
 * @param {number} age user's age
 * @param {string} gender user's gender, with a three-choice only
 * 
 * @returns {Promise<string>} an empty Promise on a successful registration
 * 
 * @throws {NotAllowedError} if a user with that same email already exists on the database
 */cov_18dwzrjbc7().s[4]++;module.exports=(name,surname,email,password,age,gender)=>{cov_18dwzrjbc7().f[0]++;cov_18dwzrjbc7().s[5]++;validate.string(name,'name');cov_18dwzrjbc7().s[6]++;validate.string(surname,'surname');cov_18dwzrjbc7().s[7]++;validate.string(email,'email');cov_18dwzrjbc7().s[8]++;validate.type(age,'age',Number);cov_18dwzrjbc7().s[9]++;validate.string(gender,'gender');cov_18dwzrjbc7().s[10]++;validate.gender(gender);cov_18dwzrjbc7().s[11]++;validate.email(email);cov_18dwzrjbc7().s[12]++;validate.string(password,'password');cov_18dwzrjbc7().s[13]++;return User.findOne({email}).then(user=>{cov_18dwzrjbc7().f[1]++;cov_18dwzrjbc7().s[14]++;if(user){cov_18dwzrjbc7().b[0][0]++;cov_18dwzrjbc7().s[15]++;throw new NotAllowedError(`user with email ${email} already exists`);}else{cov_18dwzrjbc7().b[0][1]++;}cov_18dwzrjbc7().s[16]++;return bcrypt.hash(password,10);}).then(password=>{cov_18dwzrjbc7().f[2]++;cov_18dwzrjbc7().s[17]++;user=new User({name,surname,email,age:Number(age),gender,password,created:new Date()});cov_18dwzrjbc7().s[18]++;return user.save();}).then(()=>{cov_18dwzrjbc7().f[3]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyLXVzZXIuanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJyZXF1aXJlIiwibW9kZWxzIiwiVXNlciIsIk5vdEFsbG93ZWRFcnJvciIsImJjcnlwdCIsIm1vZHVsZSIsImV4cG9ydHMiLCJuYW1lIiwic3VybmFtZSIsImVtYWlsIiwicGFzc3dvcmQiLCJhZ2UiLCJnZW5kZXIiLCJzdHJpbmciLCJ0eXBlIiwiTnVtYmVyIiwiZmluZE9uZSIsInRoZW4iLCJ1c2VyIiwiaGFzaCIsImNyZWF0ZWQiLCJEYXRlIiwic2F2ZSJdLCJtYXBwaW5ncyI6IjR3RkFBQSxLQUFNLENBQUVBLFFBQUYsMkJBQWVDLE9BQU8sQ0FBQyxpQkFBRCxDQUF0QixDQUFOLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFWLDJCQUF1QkYsT0FBTyxDQUFDLGdCQUFELENBQTlCLENBQU4sQ0FDQSxLQUFNLENBQUVHLGVBQUYsMkJBQXNCSCxPQUFPLENBQUMsa0JBQUQsQ0FBN0IsQ0FBTixDQUNBLEtBQU1JLENBQUFBLE1BQU0sMEJBQUdKLE9BQU8sQ0FBQyxVQUFELENBQVYsQ0FBWixDQUVBOzs7Ozs7Ozs7Ozs7OzJCQWVBSyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsSUFBRCxDQUFPQyxPQUFQLENBQWdCQyxLQUFoQixDQUF1QkMsUUFBdkIsQ0FBaUNDLEdBQWpDLENBQXNDQyxNQUF0QyxHQUFpRCxpREFDOURiLFFBQVEsQ0FBQ2MsTUFBVCxDQUFnQk4sSUFBaEIsQ0FBc0IsTUFBdEIsRUFEOEQsd0JBRTlEUixRQUFRLENBQUNjLE1BQVQsQ0FBZ0JMLE9BQWhCLENBQXlCLFNBQXpCLEVBRjhELHdCQUc5RFQsUUFBUSxDQUFDYyxNQUFULENBQWdCSixLQUFoQixDQUF1QixPQUF2QixFQUg4RCx3QkFJOURWLFFBQVEsQ0FBQ2UsSUFBVCxDQUFjSCxHQUFkLENBQW1CLEtBQW5CLENBQTBCSSxNQUExQixFQUo4RCx3QkFLOURoQixRQUFRLENBQUNjLE1BQVQsQ0FBZ0JELE1BQWhCLENBQXdCLFFBQXhCLEVBTDhELHlCQU05RGIsUUFBUSxDQUFDYSxNQUFULENBQWdCQSxNQUFoQixFQU44RCx5QkFPOURiLFFBQVEsQ0FBQ1UsS0FBVCxDQUFlQSxLQUFmLEVBUDhELHlCQVE5RFYsUUFBUSxDQUFDYyxNQUFULENBQWdCSCxRQUFoQixDQUEwQixVQUExQixFQVI4RCx5QkFVOUQsTUFBT1IsQ0FBQUEsSUFBSSxDQUFDYyxPQUFMLENBQWEsQ0FBRVAsS0FBRixDQUFiLEVBQ0ZRLElBREUsQ0FDR0MsSUFBSSxFQUFJLGtEQUNWLEdBQUlBLElBQUosQ0FBVSwwREFBTSxJQUFJZixDQUFBQSxlQUFKLENBQXFCLG1CQUFrQk0sS0FBTSxpQkFBN0MsQ0FBTixDQUFvRSxDQUE5RSxpQ0FEVSx5QkFHVixNQUFPTCxDQUFBQSxNQUFNLENBQUNlLElBQVAsQ0FBWVQsUUFBWixDQUFzQixFQUF0QixDQUFQLENBQ0gsQ0FMRSxFQU1GTyxJQU5FLENBTUdQLFFBQVEsRUFBSSxrREFDZFEsSUFBSSxDQUFHLEdBQUloQixDQUFBQSxJQUFKLENBQVMsQ0FBRUssSUFBRixDQUFRQyxPQUFSLENBQWlCQyxLQUFqQixDQUF3QkUsR0FBRyxDQUFFSSxNQUFNLENBQUNKLEdBQUQsQ0FBbkMsQ0FBMENDLE1BQTFDLENBQWtERixRQUFsRCxDQUE0RFUsT0FBTyxDQUFFLEdBQUlDLENBQUFBLElBQUosRUFBckUsQ0FBVCxDQUFQLENBRGMseUJBR2QsTUFBT0gsQ0FBQUEsSUFBSSxDQUFDSSxJQUFMLEVBQVAsQ0FDSCxDQVZFLEVBV0ZMLElBWEUsQ0FXRyxJQUFNLHlCQUFHLENBWFosQ0FBUCxDQWFILENBdkJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB2YWxpZGF0ZSB9ID0gcmVxdWlyZSgncG9vcGluaW9uLXV0aWxzJylcclxuY29uc3QgeyBtb2RlbHM6IHsgVXNlciB9IH0gPSByZXF1aXJlKCdwb29waW5pb24tZGF0YScpXHJcbmNvbnN0IHsgTm90QWxsb3dlZEVycm9yIH0gPSByZXF1aXJlKCdwb29waW5pb24tZXJyb3JzJylcclxuY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0anMnKVxyXG5cclxuLyoqXHJcbiAqIFJlZ2lzdGVycyBhIG5ldyB1c2VyIG9uIHRoZSBkYXRhYmFzZVxyXG4gKiBcclxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgdXNlcidzIG5hbWVcclxuICogQHBhcmFtIHtzdHJpbmd9IHN1cm5hbWUgdXNlcidzIHN1cm5hbWVcclxuICogQHBhcmFtIHtzdHJpbmd9IGVtYWlsIHVzZXIncyB1bmlxdWUgZS1tYWlsXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXNzd29yZCB1c2VyJ3MgcGFzc3dvcmQsIHdpdGggZnVydGhlciBlbmNyeXB0YXRpb25cclxuICogQHBhcmFtIHtudW1iZXJ9IGFnZSB1c2VyJ3MgYWdlXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBnZW5kZXIgdXNlcidzIGdlbmRlciwgd2l0aCBhIHRocmVlLWNob2ljZSBvbmx5XHJcbiAqIFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSBhbiBlbXB0eSBQcm9taXNlIG9uIGEgc3VjY2Vzc2Z1bCByZWdpc3RyYXRpb25cclxuICogXHJcbiAqIEB0aHJvd3Mge05vdEFsbG93ZWRFcnJvcn0gaWYgYSB1c2VyIHdpdGggdGhhdCBzYW1lIGVtYWlsIGFscmVhZHkgZXhpc3RzIG9uIHRoZSBkYXRhYmFzZVxyXG4gKi9cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gKG5hbWUsIHN1cm5hbWUsIGVtYWlsLCBwYXNzd29yZCwgYWdlLCBnZW5kZXIpID0+IHtcclxuICAgIHZhbGlkYXRlLnN0cmluZyhuYW1lLCAnbmFtZScpXHJcbiAgICB2YWxpZGF0ZS5zdHJpbmcoc3VybmFtZSwgJ3N1cm5hbWUnKVxyXG4gICAgdmFsaWRhdGUuc3RyaW5nKGVtYWlsLCAnZW1haWwnKVxyXG4gICAgdmFsaWRhdGUudHlwZShhZ2UsICdhZ2UnLCBOdW1iZXIpXHJcbiAgICB2YWxpZGF0ZS5zdHJpbmcoZ2VuZGVyLCAnZ2VuZGVyJylcclxuICAgIHZhbGlkYXRlLmdlbmRlcihnZW5kZXIpXHJcbiAgICB2YWxpZGF0ZS5lbWFpbChlbWFpbClcclxuICAgIHZhbGlkYXRlLnN0cmluZyhwYXNzd29yZCwgJ3Bhc3N3b3JkJylcclxuXHJcbiAgICByZXR1cm4gVXNlci5maW5kT25lKHsgZW1haWwgfSlcclxuICAgICAgICAudGhlbih1c2VyID0+IHtcclxuICAgICAgICAgICAgaWYgKHVzZXIpIHRocm93IG5ldyBOb3RBbGxvd2VkRXJyb3IoYHVzZXIgd2l0aCBlbWFpbCAke2VtYWlsfSBhbHJlYWR5IGV4aXN0c2ApXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYmNyeXB0Lmhhc2gocGFzc3dvcmQsIDEwKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4ocGFzc3dvcmQgPT4ge1xyXG4gICAgICAgICAgICB1c2VyID0gbmV3IFVzZXIoeyBuYW1lLCBzdXJuYW1lLCBlbWFpbCwgYWdlOiBOdW1iZXIoYWdlKSwgZ2VuZGVyLCBwYXNzd29yZCwgY3JlYXRlZDogbmV3IERhdGUgfSlcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB1c2VyLnNhdmUoKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKCkgPT4geyB9KVxyXG5cclxufSJdfQ==