function cov_1iaz0v2h0o(){var path="C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\retrieve-user.js";var hash="f35e019f29243c061310e72769237b7d32a22274";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\retrieve-user.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:47}},"1":{start:{line:2,column:29},end:{line:2,column:54}},"2":{start:{line:3,column:43},end:{line:3,column:70}},"3":{start:{line:16,column:0},end:{line:50,column:1}},"4":{start:{line:17,column:4},end:{line:17,column:29}},"5":{start:{line:19,column:4},end:{line:49,column:10}},"6":{start:{line:21,column:12},end:{line:21,column:83}},"7":{start:{line:21,column:23},end:{line:21,column:83}},"8":{start:{line:22,column:12},end:{line:22,column:96}},"9":{start:{line:22,column:34},end:{line:22,column:96}},"10":{start:{line:24,column:12},end:{line:24,column:37}},"11":{start:{line:25,column:12},end:{line:25,column:41}},"12":{start:{line:26,column:12},end:{line:26,column:27}},"13":{start:{line:27,column:12},end:{line:27,column:32}},"14":{start:{line:28,column:12},end:{line:28,column:27}},"15":{start:{line:30,column:12},end:{line:34,column:14}},"16":{start:{line:31,column:16},end:{line:31,column:49}},"17":{start:{line:32,column:16},end:{line:32,column:33}},"18":{start:{line:33,column:16},end:{line:33,column:33}},"19":{start:{line:36,column:12},end:{line:40,column:14}},"20":{start:{line:37,column:16},end:{line:37,column:51}},"21":{start:{line:38,column:16},end:{line:38,column:34}},"22":{start:{line:39,column:16},end:{line:39,column:34}},"23":{start:{line:42,column:12},end:{line:46,column:14}},"24":{start:{line:43,column:16},end:{line:43,column:49}},"25":{start:{line:44,column:16},end:{line:44,column:33}},"26":{start:{line:45,column:16},end:{line:45,column:33}},"27":{start:{line:48,column:12},end:{line:48,column:23}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:16,column:17},end:{line:16,column:18}},loc:{start:{line:16,column:23},end:{line:50,column:1}},line:16},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:14},end:{line:20,column:15}},loc:{start:{line:20,column:22},end:{line:49,column:9}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:30,column:42},end:{line:30,column:43}},loc:{start:{line:30,column:52},end:{line:34,column:13}},line:30},"3":{name:"(anonymous_3)",decl:{start:{line:36,column:34},end:{line:36,column:35}},loc:{start:{line:36,column:45},end:{line:40,column:13}},line:36},"4":{name:"(anonymous_4)",decl:{start:{line:42,column:36},end:{line:42,column:37}},loc:{start:{line:42,column:46},end:{line:46,column:13}},line:42}},branchMap:{"0":{loc:{start:{line:21,column:12},end:{line:21,column:83}},type:"if",locations:[{start:{line:21,column:12},end:{line:21,column:83}},{start:{line:21,column:12},end:{line:21,column:83}}],line:21},"1":{loc:{start:{line:22,column:12},end:{line:22,column:96}},type:"if",locations:[{start:{line:22,column:12},end:{line:22,column:96}},{start:{line:22,column:12},end:{line:22,column:96}}],line:22}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"f35e019f29243c061310e72769237b7d32a22274"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1iaz0v2h0o=function(){return actualCoverage;};return actualCoverage;}cov_1iaz0v2h0o();const{validate}=(cov_1iaz0v2h0o().s[0]++,require('poopinion-utils'));const{models:{User}}=(cov_1iaz0v2h0o().s[1]++,require('poopinion-data'));const{NotAllowedError,NotFoundError}=(cov_1iaz0v2h0o().s[2]++,require('poopinion-errors'));/**
 * Finds and receives data from a desired user
 * 
 * @param {string} id user's unique id
 * 
 * @returns {Promise<string>} user's name, surname, email, age and gender from storage
 * 
 * @throws {NotAllowedError} if the user exists but has the property 'deactivated' as true
 * @throws {NotFoundError} if the user does not exist
 */cov_1iaz0v2h0o().s[3]++;module.exports=id=>{cov_1iaz0v2h0o().f[0]++;cov_1iaz0v2h0o().s[4]++;validate.string(id,'id');cov_1iaz0v2h0o().s[5]++;return User.findById(id).populate('publishedToilets').populate('comments').populate('favToilets').lean().then(user=>{cov_1iaz0v2h0o().f[1]++;cov_1iaz0v2h0o().s[6]++;if(!user){cov_1iaz0v2h0o().b[0][0]++;cov_1iaz0v2h0o().s[7]++;throw new NotFoundError(`user with id ${id} does not exist`);}else{cov_1iaz0v2h0o().b[0][1]++;}cov_1iaz0v2h0o().s[8]++;if(user.deactivated){cov_1iaz0v2h0o().b[1][0]++;cov_1iaz0v2h0o().s[9]++;throw new NotAllowedError(`user with id ${id} is deactivated`);}else{cov_1iaz0v2h0o().b[1][1]++;}cov_1iaz0v2h0o().s[10]++;user.retrieved=new Date();cov_1iaz0v2h0o().s[11]++;user.id=user._id.toString();cov_1iaz0v2h0o().s[12]++;delete user._id;cov_1iaz0v2h0o().s[13]++;delete user.password;cov_1iaz0v2h0o().s[14]++;delete user.__v;cov_1iaz0v2h0o().s[15]++;user.publishedToilets.forEach(toilet=>{cov_1iaz0v2h0o().f[2]++;cov_1iaz0v2h0o().s[16]++;toilet.id=toilet._id.toString();cov_1iaz0v2h0o().s[17]++;delete toilet._id;cov_1iaz0v2h0o().s[18]++;delete toilet.__v;});cov_1iaz0v2h0o().s[19]++;user.comments.forEach(comment=>{cov_1iaz0v2h0o().f[3]++;cov_1iaz0v2h0o().s[20]++;comment.id=comment._id.toString();cov_1iaz0v2h0o().s[21]++;delete comment._id;cov_1iaz0v2h0o().s[22]++;delete comment.__v;});cov_1iaz0v2h0o().s[23]++;user.favToilets.forEach(toilet=>{cov_1iaz0v2h0o().f[4]++;cov_1iaz0v2h0o().s[24]++;toilet.id=toilet._id.toString();cov_1iaz0v2h0o().s[25]++;delete toilet._id;cov_1iaz0v2h0o().s[26]++;delete toilet.__v;});cov_1iaz0v2h0o().s[27]++;return user;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJldHJpZXZlLXVzZXIuanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJyZXF1aXJlIiwibW9kZWxzIiwiVXNlciIsIk5vdEFsbG93ZWRFcnJvciIsIk5vdEZvdW5kRXJyb3IiLCJtb2R1bGUiLCJleHBvcnRzIiwiaWQiLCJzdHJpbmciLCJmaW5kQnlJZCIsInBvcHVsYXRlIiwibGVhbiIsInRoZW4iLCJ1c2VyIiwiZGVhY3RpdmF0ZWQiLCJyZXRyaWV2ZWQiLCJEYXRlIiwiX2lkIiwidG9TdHJpbmciLCJwYXNzd29yZCIsIl9fdiIsInB1Ymxpc2hlZFRvaWxldHMiLCJmb3JFYWNoIiwidG9pbGV0IiwiY29tbWVudHMiLCJjb21tZW50IiwiZmF2VG9pbGV0cyJdLCJtYXBwaW5ncyI6IjZySEFBQSxLQUFNLENBQUVBLFFBQUYsMkJBQWVDLE9BQU8sQ0FBQyxpQkFBRCxDQUF0QixDQUFOLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFWLDJCQUF1QkYsT0FBTyxDQUFDLGdCQUFELENBQTlCLENBQU4sQ0FDQSxLQUFNLENBQUVHLGVBQUYsQ0FBbUJDLGFBQW5CLDJCQUFxQ0osT0FBTyxDQUFDLGtCQUFELENBQTVDLENBQU4sQ0FFQTs7Ozs7Ozs7OzJCQVdBSyxNQUFNLENBQUNDLE9BQVAsQ0FBaUJDLEVBQUUsRUFBSSxpREFDbkJSLFFBQVEsQ0FBQ1MsTUFBVCxDQUFnQkQsRUFBaEIsQ0FBb0IsSUFBcEIsRUFEbUIsd0JBR25CLE1BQU9MLENBQUFBLElBQUksQ0FBQ08sUUFBTCxDQUFjRixFQUFkLEVBQWtCRyxRQUFsQixDQUEyQixrQkFBM0IsRUFBK0NBLFFBQS9DLENBQXdELFVBQXhELEVBQW9FQSxRQUFwRSxDQUE2RSxZQUE3RSxFQUEyRkMsSUFBM0YsR0FDRkMsSUFERSxDQUNHQyxJQUFJLEVBQUksaURBQ1YsR0FBSSxDQUFDQSxJQUFMLENBQVcseURBQU0sSUFBSVQsQ0FBQUEsYUFBSixDQUFtQixnQkFBZUcsRUFBRyxpQkFBckMsQ0FBTixDQUE0RCxDQUF2RSxpQ0FEVSx3QkFFVixHQUFJTSxJQUFJLENBQUNDLFdBQVQsQ0FBc0IseURBQU0sSUFBSVgsQ0FBQUEsZUFBSixDQUFxQixnQkFBZUksRUFBRyxpQkFBdkMsQ0FBTixDQUE4RCxDQUFwRixpQ0FGVSx5QkFJVk0sSUFBSSxDQUFDRSxTQUFMLENBQWlCLEdBQUlDLENBQUFBLElBQUosRUFBakIsQ0FKVSx5QkFLVkgsSUFBSSxDQUFDTixFQUFMLENBQVVNLElBQUksQ0FBQ0ksR0FBTCxDQUFTQyxRQUFULEVBQVYsQ0FMVSx5QkFNVixNQUFPTCxDQUFBQSxJQUFJLENBQUNJLEdBQVosQ0FOVSx5QkFPVixNQUFPSixDQUFBQSxJQUFJLENBQUNNLFFBQVosQ0FQVSx5QkFRVixNQUFPTixDQUFBQSxJQUFJLENBQUNPLEdBQVosQ0FSVSx5QkFVVlAsSUFBSSxDQUFDUSxnQkFBTCxDQUFzQkMsT0FBdEIsQ0FBOEJDLE1BQU0sRUFBSSxrREFDcENBLE1BQU0sQ0FBQ2hCLEVBQVAsQ0FBWWdCLE1BQU0sQ0FBQ04sR0FBUCxDQUFXQyxRQUFYLEVBQVosQ0FEb0MseUJBRXBDLE1BQU9LLENBQUFBLE1BQU0sQ0FBQ04sR0FBZCxDQUZvQyx5QkFHcEMsTUFBT00sQ0FBQUEsTUFBTSxDQUFDSCxHQUFkLENBQ0gsQ0FKRCxFQVZVLHlCQWdCVlAsSUFBSSxDQUFDVyxRQUFMLENBQWNGLE9BQWQsQ0FBc0JHLE9BQU8sRUFBSSxrREFDN0JBLE9BQU8sQ0FBQ2xCLEVBQVIsQ0FBYWtCLE9BQU8sQ0FBQ1IsR0FBUixDQUFZQyxRQUFaLEVBQWIsQ0FENkIseUJBRTdCLE1BQU9PLENBQUFBLE9BQU8sQ0FBQ1IsR0FBZixDQUY2Qix5QkFHN0IsTUFBT1EsQ0FBQUEsT0FBTyxDQUFDTCxHQUFmLENBQ0gsQ0FKRCxFQWhCVSx5QkFzQlZQLElBQUksQ0FBQ2EsVUFBTCxDQUFnQkosT0FBaEIsQ0FBd0JDLE1BQU0sRUFBSSxrREFDOUJBLE1BQU0sQ0FBQ2hCLEVBQVAsQ0FBWWdCLE1BQU0sQ0FBQ04sR0FBUCxDQUFXQyxRQUFYLEVBQVosQ0FEOEIseUJBRTlCLE1BQU9LLENBQUFBLE1BQU0sQ0FBQ04sR0FBZCxDQUY4Qix5QkFHOUIsTUFBT00sQ0FBQUEsTUFBTSxDQUFDSCxHQUFkLENBQ0gsQ0FKRCxFQXRCVSx5QkE0QlYsTUFBT1AsQ0FBQUEsSUFBUCxDQUNILENBOUJFLENBQVAsQ0ErQkgsQ0FsQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHZhbGlkYXRlIH0gPSByZXF1aXJlKCdwb29waW5pb24tdXRpbHMnKVxyXG5jb25zdCB7IG1vZGVsczogeyBVc2VyIH0gfSA9IHJlcXVpcmUoJ3Bvb3Bpbmlvbi1kYXRhJylcclxuY29uc3QgeyBOb3RBbGxvd2VkRXJyb3IsIE5vdEZvdW5kRXJyb3IgfSA9IHJlcXVpcmUoJ3Bvb3Bpbmlvbi1lcnJvcnMnKVxyXG5cclxuLyoqXHJcbiAqIEZpbmRzIGFuZCByZWNlaXZlcyBkYXRhIGZyb20gYSBkZXNpcmVkIHVzZXJcclxuICogXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZCB1c2VyJ3MgdW5pcXVlIGlkXHJcbiAqIFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSB1c2VyJ3MgbmFtZSwgc3VybmFtZSwgZW1haWwsIGFnZSBhbmQgZ2VuZGVyIGZyb20gc3RvcmFnZVxyXG4gKiBcclxuICogQHRocm93cyB7Tm90QWxsb3dlZEVycm9yfSBpZiB0aGUgdXNlciBleGlzdHMgYnV0IGhhcyB0aGUgcHJvcGVydHkgJ2RlYWN0aXZhdGVkJyBhcyB0cnVlXHJcbiAqIEB0aHJvd3Mge05vdEZvdW5kRXJyb3J9IGlmIHRoZSB1c2VyIGRvZXMgbm90IGV4aXN0XHJcbiAqL1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBpZCA9PiB7XHJcbiAgICB2YWxpZGF0ZS5zdHJpbmcoaWQsICdpZCcpXHJcblxyXG4gICAgcmV0dXJuIFVzZXIuZmluZEJ5SWQoaWQpLnBvcHVsYXRlKCdwdWJsaXNoZWRUb2lsZXRzJykucG9wdWxhdGUoJ2NvbW1lbnRzJykucG9wdWxhdGUoJ2ZhdlRvaWxldHMnKS5sZWFuKClcclxuICAgICAgICAudGhlbih1c2VyID0+IHtcclxuICAgICAgICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcihgdXNlciB3aXRoIGlkICR7aWR9IGRvZXMgbm90IGV4aXN0YClcclxuICAgICAgICAgICAgaWYgKHVzZXIuZGVhY3RpdmF0ZWQpIHRocm93IG5ldyBOb3RBbGxvd2VkRXJyb3IoYHVzZXIgd2l0aCBpZCAke2lkfSBpcyBkZWFjdGl2YXRlZGApXHJcblxyXG4gICAgICAgICAgICB1c2VyLnJldHJpZXZlZCA9IG5ldyBEYXRlXHJcbiAgICAgICAgICAgIHVzZXIuaWQgPSB1c2VyLl9pZC50b1N0cmluZygpXHJcbiAgICAgICAgICAgIGRlbGV0ZSB1c2VyLl9pZFxyXG4gICAgICAgICAgICBkZWxldGUgdXNlci5wYXNzd29yZFxyXG4gICAgICAgICAgICBkZWxldGUgdXNlci5fX3ZcclxuXHJcbiAgICAgICAgICAgIHVzZXIucHVibGlzaGVkVG9pbGV0cy5mb3JFYWNoKHRvaWxldCA9PiB7XHJcbiAgICAgICAgICAgICAgICB0b2lsZXQuaWQgPSB0b2lsZXQuX2lkLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0b2lsZXQuX2lkXHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdG9pbGV0Ll9fdlxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgdXNlci5jb21tZW50cy5mb3JFYWNoKGNvbW1lbnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29tbWVudC5pZCA9IGNvbW1lbnQuX2lkLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBjb21tZW50Ll9pZFxyXG4gICAgICAgICAgICAgICAgZGVsZXRlIGNvbW1lbnQuX192XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICB1c2VyLmZhdlRvaWxldHMuZm9yRWFjaCh0b2lsZXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgdG9pbGV0LmlkID0gdG9pbGV0Ll9pZC50b1N0cmluZygpXHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdG9pbGV0Ll9pZFxyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRvaWxldC5fX3ZcclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB1c2VyXHJcbiAgICAgICAgfSlcclxufSJdfQ==