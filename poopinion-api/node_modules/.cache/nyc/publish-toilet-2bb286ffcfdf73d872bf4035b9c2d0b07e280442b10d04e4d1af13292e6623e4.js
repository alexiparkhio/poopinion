function cov_2auncs9aek(){var path="C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\publish-toilet.js";var hash="46b636fad5f30a42fb799064a59339ebd6ab3310";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\publish-toilet.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:47}},"1":{start:{line:2,column:37},end:{line:2,column:62}},"2":{start:{line:3,column:43},end:{line:3,column:70}},"3":{start:{line:19,column:0},end:{line:42,column:1}},"4":{start:{line:20,column:4},end:{line:20,column:29}},"5":{start:{line:21,column:4},end:{line:21,column:35}},"6":{start:{line:22,column:4},end:{line:22,column:60}},"7":{start:{line:23,column:4},end:{line:23,column:53}},"8":{start:{line:25,column:4},end:{line:41,column:24}},"9":{start:{line:27,column:12},end:{line:27,column:83}},"10":{start:{line:27,column:23},end:{line:27,column:83}},"11":{start:{line:28,column:12},end:{line:28,column:96}},"12":{start:{line:28,column:34},end:{line:28,column:96}},"13":{start:{line:30,column:27},end:{line:30,column:124}},"14":{start:{line:32,column:12},end:{line:32,column:46}},"15":{start:{line:33,column:12},end:{line:33,column:60}},"16":{start:{line:36,column:12},end:{line:36,column:45}},"17":{start:{line:37,column:12},end:{line:37,column:29}},"18":{start:{line:39,column:12},end:{line:39,column:32}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:19,column:17},end:{line:19,column:18}},loc:{start:{line:19,column:61},end:{line:42,column:1}},line:19},"1":{name:"(anonymous_1)",decl:{start:{line:26,column:14},end:{line:26,column:15}},loc:{start:{line:26,column:22},end:{line:34,column:9}},line:26},"2":{name:"(anonymous_2)",decl:{start:{line:35,column:14},end:{line:35,column:15}},loc:{start:{line:35,column:30},end:{line:40,column:9}},line:35},"3":{name:"(anonymous_3)",decl:{start:{line:41,column:14},end:{line:41,column:15}},loc:{start:{line:41,column:20},end:{line:41,column:23}},line:41}},branchMap:{"0":{loc:{start:{line:27,column:12},end:{line:27,column:83}},type:"if",locations:[{start:{line:27,column:12},end:{line:27,column:83}},{start:{line:27,column:12},end:{line:27,column:83}}],line:27},"1":{loc:{start:{line:28,column:12},end:{line:28,column:96}},type:"if",locations:[{start:{line:28,column:12},end:{line:28,column:96}},{start:{line:28,column:12},end:{line:28,column:96}}],line:28}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"46b636fad5f30a42fb799064a59339ebd6ab3310"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_2auncs9aek=function(){return actualCoverage;};return actualCoverage;}cov_2auncs9aek();const{validate}=(cov_2auncs9aek().s[0]++,require('poopinion-utils'));const{models:{User,Toilet}}=(cov_2auncs9aek().s[1]++,require('poopinion-data'));const{NotAllowedError,NotFoundError}=(cov_2auncs9aek().s[2]++,require('poopinion-errors'));/**
 * Publishes a new toilet post
 * 
 * @param {string} id user's unique id
 * @param {string} place location of the toilet
 * @param {boolean} disabledToilet if the place have a disabled toilet available
 * @param {object} coordinates Google maps location of the place. Includes: latitude, latitudeDelta, longitude, longitudeDelta
 * 
 * @returns {Promise<string>} returns an empty Promise on a successful toilet publish
 * 
 * @throws {NotAllowedError} if the user exists but has the property 'deactivated' as true
 * @throws {NotFoundError} if the user does not exist
 */cov_2auncs9aek().s[3]++;module.exports=(id,place,disabledToilet,coordinates)=>{cov_2auncs9aek().f[0]++;cov_2auncs9aek().s[4]++;validate.string(id,'id');cov_2auncs9aek().s[5]++;validate.string(place,'place');cov_2auncs9aek().s[6]++;validate.type(disabledToilet,'disabledToilet',Boolean);cov_2auncs9aek().s[7]++;validate.type(coordinates,'coordinates',Object);cov_2auncs9aek().s[8]++;return User.findById(id).then(user=>{cov_2auncs9aek().f[1]++;cov_2auncs9aek().s[9]++;if(!user){cov_2auncs9aek().b[0][0]++;cov_2auncs9aek().s[10]++;throw new NotFoundError(`user with id ${id} does not exist`);}else{cov_2auncs9aek().b[0][1]++;}cov_2auncs9aek().s[11]++;if(user.deactivated){cov_2auncs9aek().b[1][0]++;cov_2auncs9aek().s[12]++;throw new NotAllowedError(`user with id ${id} is deactivated`);}else{cov_2auncs9aek().b[1][1]++;}const toilet=(cov_2auncs9aek().s[13]++,new Toilet({place,created:new Date(),publisher:id,geolocation:coordinates,disabledToilet}));cov_2auncs9aek().s[14]++;user.publishedToilets.push(toilet);cov_2auncs9aek().s[15]++;return Promise.all([user.save(),toilet.save()]);}).then(([,toilet])=>{cov_2auncs9aek().f[2]++;cov_2auncs9aek().s[16]++;toilet.id=toilet._id.toString();cov_2auncs9aek().s[17]++;delete toilet._id;cov_2auncs9aek().s[18]++;return toilet.save();}).then(()=>{cov_2auncs9aek().f[3]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInB1Ymxpc2gtdG9pbGV0LmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlVzZXIiLCJUb2lsZXQiLCJOb3RBbGxvd2VkRXJyb3IiLCJOb3RGb3VuZEVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsImlkIiwicGxhY2UiLCJkaXNhYmxlZFRvaWxldCIsImNvb3JkaW5hdGVzIiwic3RyaW5nIiwidHlwZSIsIkJvb2xlYW4iLCJPYmplY3QiLCJmaW5kQnlJZCIsInRoZW4iLCJ1c2VyIiwiZGVhY3RpdmF0ZWQiLCJ0b2lsZXQiLCJjcmVhdGVkIiwiRGF0ZSIsInB1Ymxpc2hlciIsImdlb2xvY2F0aW9uIiwicHVibGlzaGVkVG9pbGV0cyIsInB1c2giLCJQcm9taXNlIiwiYWxsIiwic2F2ZSIsIl9pZCIsInRvU3RyaW5nIl0sIm1hcHBpbmdzIjoiaytGQUFBLEtBQU0sQ0FBRUEsUUFBRiwyQkFBZUMsT0FBTyxDQUFDLGlCQUFELENBQXRCLENBQU4sQ0FDQSxLQUFNLENBQUVDLE1BQU0sQ0FBRSxDQUFFQyxJQUFGLENBQVFDLE1BQVIsQ0FBViwyQkFBK0JILE9BQU8sQ0FBQyxnQkFBRCxDQUF0QyxDQUFOLENBQ0EsS0FBTSxDQUFFSSxlQUFGLENBQW1CQyxhQUFuQiwyQkFBcUNMLE9BQU8sQ0FBQyxrQkFBRCxDQUE1QyxDQUFOLENBRUE7Ozs7Ozs7Ozs7OzsyQkFjQU0sTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLEVBQUQsQ0FBS0MsS0FBTCxDQUFZQyxjQUFaLENBQTRCQyxXQUE1QixHQUE0QyxpREFDekRaLFFBQVEsQ0FBQ2EsTUFBVCxDQUFnQkosRUFBaEIsQ0FBb0IsSUFBcEIsRUFEeUQsd0JBRXpEVCxRQUFRLENBQUNhLE1BQVQsQ0FBZ0JILEtBQWhCLENBQXVCLE9BQXZCLEVBRnlELHdCQUd6RFYsUUFBUSxDQUFDYyxJQUFULENBQWNILGNBQWQsQ0FBOEIsZ0JBQTlCLENBQWdESSxPQUFoRCxFQUh5RCx3QkFJekRmLFFBQVEsQ0FBQ2MsSUFBVCxDQUFjRixXQUFkLENBQTJCLGFBQTNCLENBQTBDSSxNQUExQyxFQUp5RCx3QkFNekQsTUFBT2IsQ0FBQUEsSUFBSSxDQUFDYyxRQUFMLENBQWNSLEVBQWQsRUFDRlMsSUFERSxDQUNHQyxJQUFJLEVBQUksaURBQ1YsR0FBSSxDQUFDQSxJQUFMLENBQVcsMERBQU0sSUFBSWIsQ0FBQUEsYUFBSixDQUFtQixnQkFBZUcsRUFBRyxpQkFBckMsQ0FBTixDQUE0RCxDQUF2RSxpQ0FEVSx5QkFFVixHQUFJVSxJQUFJLENBQUNDLFdBQVQsQ0FBc0IsMERBQU0sSUFBSWYsQ0FBQUEsZUFBSixDQUFxQixnQkFBZUksRUFBRyxpQkFBdkMsQ0FBTixDQUE4RCxDQUFwRixpQ0FFQSxLQUFNWSxDQUFBQSxNQUFNLDJCQUFHLEdBQUlqQixDQUFBQSxNQUFKLENBQVcsQ0FBRU0sS0FBRixDQUFTWSxPQUFPLENBQUUsR0FBSUMsQ0FBQUEsSUFBSixFQUFsQixDQUE0QkMsU0FBUyxDQUFFZixFQUF2QyxDQUEyQ2dCLFdBQVcsQ0FBRWIsV0FBeEQsQ0FBcUVELGNBQXJFLENBQVgsQ0FBSCxDQUFaLENBSlUseUJBTVZRLElBQUksQ0FBQ08sZ0JBQUwsQ0FBc0JDLElBQXRCLENBQTJCTixNQUEzQixFQU5VLHlCQU9WLE1BQU9PLENBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLENBQUNWLElBQUksQ0FBQ1csSUFBTCxFQUFELENBQWNULE1BQU0sQ0FBQ1MsSUFBUCxFQUFkLENBQVosQ0FBUCxDQUNILENBVEUsRUFVRlosSUFWRSxDQVVHLENBQUMsRUFBR0csTUFBSCxDQUFELEdBQWdCLGtEQUNsQkEsTUFBTSxDQUFDWixFQUFQLENBQVlZLE1BQU0sQ0FBQ1UsR0FBUCxDQUFXQyxRQUFYLEVBQVosQ0FEa0IseUJBRWxCLE1BQU9YLENBQUFBLE1BQU0sQ0FBQ1UsR0FBZCxDQUZrQix5QkFJbEIsTUFBT1YsQ0FBQUEsTUFBTSxDQUFDUyxJQUFQLEVBQVAsQ0FDSCxDQWZFLEVBZ0JGWixJQWhCRSxDQWdCRyxJQUFNLHlCQUFHLENBaEJaLENBQVAsQ0FpQkgsQ0F2QkQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHZhbGlkYXRlIH0gPSByZXF1aXJlKCdwb29waW5pb24tdXRpbHMnKVxyXG5jb25zdCB7IG1vZGVsczogeyBVc2VyLCBUb2lsZXQgfSB9ID0gcmVxdWlyZSgncG9vcGluaW9uLWRhdGEnKVxyXG5jb25zdCB7IE5vdEFsbG93ZWRFcnJvciwgTm90Rm91bmRFcnJvciB9ID0gcmVxdWlyZSgncG9vcGluaW9uLWVycm9ycycpXHJcblxyXG4vKipcclxuICogUHVibGlzaGVzIGEgbmV3IHRvaWxldCBwb3N0XHJcbiAqIFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gaWQgdXNlcidzIHVuaXF1ZSBpZFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGxhY2UgbG9jYXRpb24gb2YgdGhlIHRvaWxldFxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGRpc2FibGVkVG9pbGV0IGlmIHRoZSBwbGFjZSBoYXZlIGEgZGlzYWJsZWQgdG9pbGV0IGF2YWlsYWJsZVxyXG4gKiBAcGFyYW0ge29iamVjdH0gY29vcmRpbmF0ZXMgR29vZ2xlIG1hcHMgbG9jYXRpb24gb2YgdGhlIHBsYWNlLiBJbmNsdWRlczogbGF0aXR1ZGUsIGxhdGl0dWRlRGVsdGEsIGxvbmdpdHVkZSwgbG9uZ2l0dWRlRGVsdGFcclxuICogXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPHN0cmluZz59IHJldHVybnMgYW4gZW1wdHkgUHJvbWlzZSBvbiBhIHN1Y2Nlc3NmdWwgdG9pbGV0IHB1Ymxpc2hcclxuICogXHJcbiAqIEB0aHJvd3Mge05vdEFsbG93ZWRFcnJvcn0gaWYgdGhlIHVzZXIgZXhpc3RzIGJ1dCBoYXMgdGhlIHByb3BlcnR5ICdkZWFjdGl2YXRlZCcgYXMgdHJ1ZVxyXG4gKiBAdGhyb3dzIHtOb3RGb3VuZEVycm9yfSBpZiB0aGUgdXNlciBkb2VzIG5vdCBleGlzdFxyXG4gKi9cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gKGlkLCBwbGFjZSwgZGlzYWJsZWRUb2lsZXQsIGNvb3JkaW5hdGVzKSA9PiB7XHJcbiAgICB2YWxpZGF0ZS5zdHJpbmcoaWQsICdpZCcpXHJcbiAgICB2YWxpZGF0ZS5zdHJpbmcocGxhY2UsICdwbGFjZScpXHJcbiAgICB2YWxpZGF0ZS50eXBlKGRpc2FibGVkVG9pbGV0LCAnZGlzYWJsZWRUb2lsZXQnLCBCb29sZWFuKVxyXG4gICAgdmFsaWRhdGUudHlwZShjb29yZGluYXRlcywgJ2Nvb3JkaW5hdGVzJywgT2JqZWN0KVxyXG5cclxuICAgIHJldHVybiBVc2VyLmZpbmRCeUlkKGlkKVxyXG4gICAgICAgIC50aGVuKHVzZXIgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKGB1c2VyIHdpdGggaWQgJHtpZH0gZG9lcyBub3QgZXhpc3RgKVxyXG4gICAgICAgICAgICBpZiAodXNlci5kZWFjdGl2YXRlZCkgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvcihgdXNlciB3aXRoIGlkICR7aWR9IGlzIGRlYWN0aXZhdGVkYClcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRvaWxldCA9IG5ldyBUb2lsZXQoeyBwbGFjZSwgY3JlYXRlZDogbmV3IERhdGUsIHB1Ymxpc2hlcjogaWQsIGdlb2xvY2F0aW9uOiBjb29yZGluYXRlcywgZGlzYWJsZWRUb2lsZXQgfSlcclxuXHJcbiAgICAgICAgICAgIHVzZXIucHVibGlzaGVkVG9pbGV0cy5wdXNoKHRvaWxldClcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFt1c2VyLnNhdmUoKSwgdG9pbGV0LnNhdmUoKV0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbigoWywgdG9pbGV0XSkgPT4ge1xyXG4gICAgICAgICAgICB0b2lsZXQuaWQgPSB0b2lsZXQuX2lkLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgZGVsZXRlIHRvaWxldC5faWRcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0b2lsZXQuc2F2ZSgpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbigoKSA9PiB7IH0pXHJcbn0iXX0=