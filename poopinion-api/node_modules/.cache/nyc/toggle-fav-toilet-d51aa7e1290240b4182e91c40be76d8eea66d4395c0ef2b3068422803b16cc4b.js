function cov_16qkx5zqyk(){var path="C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\toggle-fav-toilet.js";var hash="f135e5800ac07837675271316793100a86a38064";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\toggle-fav-toilet.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:47}},"1":{start:{line:2,column:37},end:{line:2,column:62}},"2":{start:{line:3,column:43},end:{line:3,column:70}},"3":{start:{line:17,column:0},end:{line:37,column:1}},"4":{start:{line:18,column:4},end:{line:18,column:29}},"5":{start:{line:19,column:4},end:{line:19,column:42}},"6":{start:{line:21,column:4},end:{line:36,column:24}},"7":{start:{line:23,column:12},end:{line:23,column:83}},"8":{start:{line:23,column:23},end:{line:23,column:83}},"9":{start:{line:24,column:12},end:{line:24,column:96}},"10":{start:{line:24,column:34},end:{line:24,column:96}},"11":{start:{line:25,column:12},end:{line:25,column:93}},"12":{start:{line:25,column:25},end:{line:25,column:93}},"13":{start:{line:27,column:12},end:{line:27,column:276}},"14":{start:{line:27,column:41},end:{line:27,column:276}},"15":{start:{line:29,column:12},end:{line:32,column:13}},"16":{start:{line:29,column:25},end:{line:29,column:26}},"17":{start:{line:30,column:26},end:{line:30,column:55}},"18":{start:{line:31,column:16},end:{line:31,column:265}},"19":{start:{line:31,column:38},end:{line:31,column:265}},"20":{start:{line:34,column:12},end:{line:34,column:247}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:17},end:{line:17,column:18}},loc:{start:{line:17,column:35},end:{line:37,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:22,column:14},end:{line:22,column:15}},loc:{start:{line:22,column:34},end:{line:35,column:9}},line:22},"2":{name:"(anonymous_2)",decl:{start:{line:27,column:266},end:{line:27,column:267}},loc:{start:{line:27,column:272},end:{line:27,column:275}},line:27},"3":{name:"(anonymous_3)",decl:{start:{line:31,column:255},end:{line:31,column:256}},loc:{start:{line:31,column:261},end:{line:31,column:264}},line:31},"4":{name:"(anonymous_4)",decl:{start:{line:34,column:237},end:{line:34,column:238}},loc:{start:{line:34,column:243},end:{line:34,column:246}},line:34},"5":{name:"(anonymous_5)",decl:{start:{line:36,column:14},end:{line:36,column:15}},loc:{start:{line:36,column:20},end:{line:36,column:23}},line:36}},branchMap:{"0":{loc:{start:{line:23,column:12},end:{line:23,column:83}},type:"if",locations:[{start:{line:23,column:12},end:{line:23,column:83}},{start:{line:23,column:12},end:{line:23,column:83}}],line:23},"1":{loc:{start:{line:24,column:12},end:{line:24,column:96}},type:"if",locations:[{start:{line:24,column:12},end:{line:24,column:96}},{start:{line:24,column:12},end:{line:24,column:96}}],line:24},"2":{loc:{start:{line:25,column:12},end:{line:25,column:93}},type:"if",locations:[{start:{line:25,column:12},end:{line:25,column:93}},{start:{line:25,column:12},end:{line:25,column:93}}],line:25},"3":{loc:{start:{line:27,column:12},end:{line:27,column:276}},type:"if",locations:[{start:{line:27,column:12},end:{line:27,column:276}},{start:{line:27,column:12},end:{line:27,column:276}}],line:27},"4":{loc:{start:{line:31,column:16},end:{line:31,column:265}},type:"if",locations:[{start:{line:31,column:16},end:{line:31,column:265}},{start:{line:31,column:16},end:{line:31,column:265}}],line:31}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"f135e5800ac07837675271316793100a86a38064"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_16qkx5zqyk=function(){return actualCoverage;};return actualCoverage;}cov_16qkx5zqyk();const{validate}=(cov_16qkx5zqyk().s[0]++,require('poopinion-utils'));const{models:{User,Toilet}}=(cov_16qkx5zqyk().s[1]++,require('poopinion-data'));const{NotAllowedError,NotFoundError}=(cov_16qkx5zqyk().s[2]++,require('poopinion-errors'));/**
 * Adds the specific toilet post on favToilets array of specific user. Removes it if it's already on favToilets array
 * 
 * @param {string} id user's unique id
 * @param {string} toiletId toilet's unique id
 * 
 * @returns {Promise<string>} returns an empty Promise
 * 
 * @throws {NotAllowedError} if the user exists but has the property 'deactivated' as true
 * @throws {NotFoundError} if the user or the toilet do not exis
 */cov_16qkx5zqyk().s[3]++;module.exports=(id,toiletId)=>{cov_16qkx5zqyk().f[0]++;cov_16qkx5zqyk().s[4]++;validate.string(id,'id');cov_16qkx5zqyk().s[5]++;validate.string(toiletId,'toilet ID');cov_16qkx5zqyk().s[6]++;return Promise.all([User.findById(id).lean(),Toilet.findById(toiletId).lean()]).then(([user,toilet])=>{cov_16qkx5zqyk().f[1]++;cov_16qkx5zqyk().s[7]++;if(!user){cov_16qkx5zqyk().b[0][0]++;cov_16qkx5zqyk().s[8]++;throw new NotFoundError(`user with id ${id} does not exist`);}else{cov_16qkx5zqyk().b[0][1]++;}cov_16qkx5zqyk().s[9]++;if(user.deactivated){cov_16qkx5zqyk().b[1][0]++;cov_16qkx5zqyk().s[10]++;throw new NotAllowedError(`user with id ${id} is deactivated`);}else{cov_16qkx5zqyk().b[1][1]++;}cov_16qkx5zqyk().s[11]++;if(!toilet){cov_16qkx5zqyk().b[2][0]++;cov_16qkx5zqyk().s[12]++;throw new NotFoundError(`toilet with id ${toiletId} does not exist`);}else{cov_16qkx5zqyk().b[2][1]++;}cov_16qkx5zqyk().s[13]++;if(!user.favToilets.length){cov_16qkx5zqyk().b[3][0]++;cov_16qkx5zqyk().s[14]++;return Promise.all([User.findByIdAndUpdate(user._id.toString(),{$addToSet:{favToilets:toilet._id.toString()}}),Toilet.findByIdAndUpdate(toilet._id.toString(),{$addToSet:{isFavedBy:user._id.toString()}})]).then(()=>{cov_16qkx5zqyk().f[2]++;});}else{cov_16qkx5zqyk().b[3][1]++;}cov_16qkx5zqyk().s[15]++;for(let i=(cov_16qkx5zqyk().s[16]++,0);i<user.favToilets.length;i++){let fav=(cov_16qkx5zqyk().s[17]++,user.favToilets[i].toString());cov_16qkx5zqyk().s[18]++;if(fav===toiletId){cov_16qkx5zqyk().b[4][0]++;cov_16qkx5zqyk().s[19]++;return Promise.all([User.findByIdAndUpdate(user._id.toString(),{$pull:{favToilets:toilet._id.toString()}}),Toilet.findByIdAndUpdate(toilet._id.toString(),{$pull:{isFavedBy:user._id.toString()}})]).then(()=>{cov_16qkx5zqyk().f[3]++;});}else{cov_16qkx5zqyk().b[4][1]++;}}cov_16qkx5zqyk().s[20]++;return Promise.all([User.findByIdAndUpdate(user._id.toString(),{$addToSet:{favToilets:toilet._id.toString()}}),Toilet.findByIdAndUpdate(toilet._id.toString(),{$addToSet:{isFavedBy:user._id.toString()}})]).then(()=>{cov_16qkx5zqyk().f[4]++;});}).then(()=>{cov_16qkx5zqyk().f[5]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvZ2dsZS1mYXYtdG9pbGV0LmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlVzZXIiLCJUb2lsZXQiLCJOb3RBbGxvd2VkRXJyb3IiLCJOb3RGb3VuZEVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsImlkIiwidG9pbGV0SWQiLCJzdHJpbmciLCJQcm9taXNlIiwiYWxsIiwiZmluZEJ5SWQiLCJsZWFuIiwidGhlbiIsInVzZXIiLCJ0b2lsZXQiLCJkZWFjdGl2YXRlZCIsImZhdlRvaWxldHMiLCJsZW5ndGgiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIl9pZCIsInRvU3RyaW5nIiwiJGFkZFRvU2V0IiwiaXNGYXZlZEJ5IiwiaSIsImZhdiIsIiRwdWxsIl0sIm1hcHBpbmdzIjoiK2hJQUFBLEtBQU0sQ0FBRUEsUUFBRiwyQkFBZUMsT0FBTyxDQUFDLGlCQUFELENBQXRCLENBQU4sQ0FDQSxLQUFNLENBQUVDLE1BQU0sQ0FBRSxDQUFFQyxJQUFGLENBQVFDLE1BQVIsQ0FBViwyQkFBK0JILE9BQU8sQ0FBQyxnQkFBRCxDQUF0QyxDQUFOLENBQ0EsS0FBTSxDQUFFSSxlQUFGLENBQW1CQyxhQUFuQiwyQkFBcUNMLE9BQU8sQ0FBQyxrQkFBRCxDQUE1QyxDQUFOLENBRUE7Ozs7Ozs7Ozs7MkJBWUFNLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUFDQyxFQUFELENBQUtDLFFBQUwsR0FBa0IsaURBQy9CVixRQUFRLENBQUNXLE1BQVQsQ0FBZ0JGLEVBQWhCLENBQW9CLElBQXBCLEVBRCtCLHdCQUUvQlQsUUFBUSxDQUFDVyxNQUFULENBQWdCRCxRQUFoQixDQUEwQixXQUExQixFQUYrQix3QkFJL0IsTUFBT0UsQ0FBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksQ0FBQ1YsSUFBSSxDQUFDVyxRQUFMLENBQWNMLEVBQWQsRUFBa0JNLElBQWxCLEVBQUQsQ0FBMkJYLE1BQU0sQ0FBQ1UsUUFBUCxDQUFnQkosUUFBaEIsRUFBMEJLLElBQTFC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QVQsRUFBYixDQUFiLENBQWhELENBQXBHLENBQVosRUFBcU5SLElBQXJOLENBQTBOLElBQU0seUJBQUcsQ0FBbk8sQ0FBUCxDQUNILENBZEUsRUFlRkEsSUFmRSxDQWVHLElBQU0seUJBQUcsQ0FmWixDQUFQLENBZ0JILENBcEJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB2YWxpZGF0ZSB9ID0gcmVxdWlyZSgncG9vcGluaW9uLXV0aWxzJylcclxuY29uc3QgeyBtb2RlbHM6IHsgVXNlciwgVG9pbGV0IH0gfSA9IHJlcXVpcmUoJ3Bvb3Bpbmlvbi1kYXRhJylcclxuY29uc3QgeyBOb3RBbGxvd2VkRXJyb3IsIE5vdEZvdW5kRXJyb3IgfSA9IHJlcXVpcmUoJ3Bvb3Bpbmlvbi1lcnJvcnMnKVxyXG5cclxuLyoqXHJcbiAqIEFkZHMgdGhlIHNwZWNpZmljIHRvaWxldCBwb3N0IG9uIGZhdlRvaWxldHMgYXJyYXkgb2Ygc3BlY2lmaWMgdXNlci4gUmVtb3ZlcyBpdCBpZiBpdCdzIGFscmVhZHkgb24gZmF2VG9pbGV0cyBhcnJheVxyXG4gKiBcclxuICogQHBhcmFtIHtzdHJpbmd9IGlkIHVzZXIncyB1bmlxdWUgaWRcclxuICogQHBhcmFtIHtzdHJpbmd9IHRvaWxldElkIHRvaWxldCdzIHVuaXF1ZSBpZFxyXG4gKiBcclxuICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPn0gcmV0dXJucyBhbiBlbXB0eSBQcm9taXNlXHJcbiAqIFxyXG4gKiBAdGhyb3dzIHtOb3RBbGxvd2VkRXJyb3J9IGlmIHRoZSB1c2VyIGV4aXN0cyBidXQgaGFzIHRoZSBwcm9wZXJ0eSAnZGVhY3RpdmF0ZWQnIGFzIHRydWVcclxuICogQHRocm93cyB7Tm90Rm91bmRFcnJvcn0gaWYgdGhlIHVzZXIgb3IgdGhlIHRvaWxldCBkbyBub3QgZXhpc1xyXG4gKi9cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gKGlkLCB0b2lsZXRJZCkgPT4ge1xyXG4gICAgdmFsaWRhdGUuc3RyaW5nKGlkLCAnaWQnKVxyXG4gICAgdmFsaWRhdGUuc3RyaW5nKHRvaWxldElkLCAndG9pbGV0IElEJylcclxuXHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1VzZXIuZmluZEJ5SWQoaWQpLmxlYW4oKSwgVG9pbGV0LmZpbmRCeUlkKHRvaWxldElkKS5sZWFuKCldKVxyXG4gICAgICAgIC50aGVuKChbdXNlciwgdG9pbGV0XSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKGB1c2VyIHdpdGggaWQgJHtpZH0gZG9lcyBub3QgZXhpc3RgKVxyXG4gICAgICAgICAgICBpZiAodXNlci5kZWFjdGl2YXRlZCkgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvcihgdXNlciB3aXRoIGlkICR7aWR9IGlzIGRlYWN0aXZhdGVkYClcclxuICAgICAgICAgICAgaWYgKCF0b2lsZXQpIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKGB0b2lsZXQgd2l0aCBpZCAke3RvaWxldElkfSBkb2VzIG5vdCBleGlzdGApXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoIXVzZXIuZmF2VG9pbGV0cy5sZW5ndGgpIHJldHVybiBQcm9taXNlLmFsbChbVXNlci5maW5kQnlJZEFuZFVwZGF0ZSh1c2VyLl9pZC50b1N0cmluZygpLCB7ICRhZGRUb1NldDogeyBmYXZUb2lsZXRzOiB0b2lsZXQuX2lkLnRvU3RyaW5nKCkgfSB9KSwgVG9pbGV0LmZpbmRCeUlkQW5kVXBkYXRlKHRvaWxldC5faWQudG9TdHJpbmcoKSwgeyAkYWRkVG9TZXQ6IHsgaXNGYXZlZEJ5OiB1c2VyLl9pZC50b1N0cmluZygpIH0gfSldKS50aGVuKCgpID0+IHsgfSlcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlci5mYXZUb2lsZXRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmF2ID0gdXNlci5mYXZUb2lsZXRzW2ldLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgICAgIGlmIChmYXYgPT09IHRvaWxldElkKSByZXR1cm4gUHJvbWlzZS5hbGwoW1VzZXIuZmluZEJ5SWRBbmRVcGRhdGUodXNlci5faWQudG9TdHJpbmcoKSwgeyAkcHVsbDogeyBmYXZUb2lsZXRzOiB0b2lsZXQuX2lkLnRvU3RyaW5nKCkgfSB9KSwgVG9pbGV0LmZpbmRCeUlkQW5kVXBkYXRlKHRvaWxldC5faWQudG9TdHJpbmcoKSwgeyAkcHVsbDogeyBpc0ZhdmVkQnk6IHVzZXIuX2lkLnRvU3RyaW5nKCkgfSB9KV0pLnRoZW4oKCkgPT4geyB9KVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1VzZXIuZmluZEJ5SWRBbmRVcGRhdGUodXNlci5faWQudG9TdHJpbmcoKSwgeyAkYWRkVG9TZXQ6IHsgZmF2VG9pbGV0czogdG9pbGV0Ll9pZC50b1N0cmluZygpIH0gfSksIFRvaWxldC5maW5kQnlJZEFuZFVwZGF0ZSh0b2lsZXQuX2lkLnRvU3RyaW5nKCksIHsgJGFkZFRvU2V0OiB7IGlzRmF2ZWRCeTogdXNlci5faWQudG9TdHJpbmcoKSB9IH0pXSkudGhlbigoKSA9PiB7IH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbigoKSA9PiB7IH0pXHJcbn0iXX0=