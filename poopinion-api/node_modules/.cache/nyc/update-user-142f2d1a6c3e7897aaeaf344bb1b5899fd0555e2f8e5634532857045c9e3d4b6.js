function cov_1cwivwlmv(){var path="C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\update-user.js";var hash="b8fd54e2405b02a8e76253afed91273cf200c812";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Alex\\bootcamp\\collab\\skylab-bootcamp-202001\\staff\\alex-park\\poopinion\\poopinion-api\\logic\\update-user.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:47}},"1":{start:{line:2,column:29},end:{line:2,column:54}},"2":{start:{line:3,column:43},end:{line:3,column:70}},"3":{start:{line:4,column:15},end:{line:4,column:34}},"4":{start:{line:19,column:0},end:{line:57,column:1}},"5":{start:{line:20,column:4},end:{line:20,column:29}},"6":{start:{line:21,column:4},end:{line:21,column:39}},"7":{start:{line:22,column:4},end:{line:22,column:41}},"8":{start:{line:24,column:28},end:{line:24,column:32}},"9":{start:{line:26,column:4},end:{line:28,column:5}},"10":{start:{line:27,column:8},end:{line:27,column:51}},"11":{start:{line:30,column:4},end:{line:56,column:10}},"12":{start:{line:32,column:12},end:{line:32,column:83}},"13":{start:{line:32,column:23},end:{line:32,column:83}},"14":{start:{line:33,column:12},end:{line:33,column:96}},"15":{start:{line:33,column:34},end:{line:33,column:96}},"16":{start:{line:35,column:12},end:{line:55,column:18}},"17":{start:{line:37,column:20},end:{line:37,column:86}},"18":{start:{line:37,column:40},end:{line:37,column:86}},"19":{start:{line:39,column:20},end:{line:39,column:69}},"20":{start:{line:42,column:20},end:{line:54,column:21}},"21":{start:{line:43,column:24},end:{line:53,column:44}},"22":{start:{line:44,column:45},end:{line:44,column:107}},"23":{start:{line:45,column:40},end:{line:45,column:57}},"24":{start:{line:47,column:32},end:{line:47,column:52}},"25":{start:{line:48,column:32},end:{line:48,column:64}},"26":{start:{line:49,column:32},end:{line:49,column:55}},"27":{start:{line:51,column:32},end:{line:51,column:50}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:19,column:17},end:{line:19,column:18}},loc:{start:{line:19,column:41},end:{line:57,column:1}},line:19},"1":{name:"(anonymous_1)",decl:{start:{line:31,column:14},end:{line:31,column:15}},loc:{start:{line:31,column:22},end:{line:56,column:9}},line:31},"2":{name:"(anonymous_2)",decl:{start:{line:36,column:22},end:{line:36,column:23}},loc:{start:{line:36,column:39},end:{line:40,column:17}},line:36},"3":{name:"(anonymous_3)",decl:{start:{line:41,column:22},end:{line:41,column:23}},loc:{start:{line:41,column:28},end:{line:55,column:17}},line:41},"4":{name:"(anonymous_4)",decl:{start:{line:44,column:34},end:{line:44,column:35}},loc:{start:{line:44,column:45},end:{line:44,column:107}},line:44},"5":{name:"(anonymous_5)",decl:{start:{line:45,column:34},end:{line:45,column:35}},loc:{start:{line:45,column:40},end:{line:45,column:57}},line:45},"6":{name:"(anonymous_6)",decl:{start:{line:46,column:34},end:{line:46,column:35}},loc:{start:{line:46,column:42},end:{line:52,column:29}},line:46},"7":{name:"(anonymous_7)",decl:{start:{line:53,column:34},end:{line:53,column:35}},loc:{start:{line:53,column:40},end:{line:53,column:43}},line:53}},branchMap:{"0":{loc:{start:{line:26,column:4},end:{line:28,column:5}},type:"if",locations:[{start:{line:26,column:4},end:{line:28,column:5}},{start:{line:26,column:4},end:{line:28,column:5}}],line:26},"1":{loc:{start:{line:32,column:12},end:{line:32,column:83}},type:"if",locations:[{start:{line:32,column:12},end:{line:32,column:83}},{start:{line:32,column:12},end:{line:32,column:83}}],line:32},"2":{loc:{start:{line:33,column:12},end:{line:33,column:96}},type:"if",locations:[{start:{line:33,column:12},end:{line:33,column:96}},{start:{line:33,column:12},end:{line:33,column:96}}],line:33},"3":{loc:{start:{line:37,column:20},end:{line:37,column:86}},type:"if",locations:[{start:{line:37,column:20},end:{line:37,column:86}},{start:{line:37,column:20},end:{line:37,column:86}}],line:37},"4":{loc:{start:{line:42,column:20},end:{line:54,column:21}},type:"if",locations:[{start:{line:42,column:20},end:{line:54,column:21}},{start:{line:42,column:20},end:{line:54,column:21}}],line:42}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b8fd54e2405b02a8e76253afed91273cf200c812"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1cwivwlmv=function(){return actualCoverage;};return actualCoverage;}cov_1cwivwlmv();const{validate}=(cov_1cwivwlmv().s[0]++,require('poopinion-utils'));const{models:{User}}=(cov_1cwivwlmv().s[1]++,require('poopinion-data'));const{NotAllowedError,NotFoundError}=(cov_1cwivwlmv().s[2]++,require('poopinion-errors'));const bcrypt=(cov_1cwivwlmv().s[3]++,require('bcryptjs'));/**
 * Updates the user's info
 * 
 * @param {string} id user's unique ID
 * @param {object} data the elements that will be updated
 * @param {string} password user's password
 * 
 * @returns {Promise<string>} an empty Promise on a successful update
 * 
 * @throws {NotAllowedError} if a user set a wrong password
 * @throws {NotFoundError} if the user does not exist
 */cov_1cwivwlmv().s[4]++;module.exports=(id,data,password)=>{cov_1cwivwlmv().f[0]++;cov_1cwivwlmv().s[5]++;validate.string(id,'id');cov_1cwivwlmv().s[6]++;validate.type(data,'data',Object);cov_1cwivwlmv().s[7]++;validate.string(password,'password');const{newPassword}=(cov_1cwivwlmv().s[8]++,data);cov_1cwivwlmv().s[9]++;if(typeof newPassword!=='undefined'){cov_1cwivwlmv().b[0][0]++;cov_1cwivwlmv().s[10]++;validate.string(newPassword,'newPassword');}else{cov_1cwivwlmv().b[0][1]++;}cov_1cwivwlmv().s[11]++;return User.findById(id).then(user=>{cov_1cwivwlmv().f[1]++;cov_1cwivwlmv().s[12]++;if(!user){cov_1cwivwlmv().b[1][0]++;cov_1cwivwlmv().s[13]++;throw new NotFoundError(`user with id ${id} does not exist`);}else{cov_1cwivwlmv().b[1][1]++;}cov_1cwivwlmv().s[14]++;if(user.deactivated){cov_1cwivwlmv().b[2][0]++;cov_1cwivwlmv().s[15]++;throw new NotAllowedError(`user with id ${id} is deactivated`);}else{cov_1cwivwlmv().b[2][1]++;}cov_1cwivwlmv().s[16]++;return bcrypt.compare(password,user.password).then(validPassword=>{cov_1cwivwlmv().f[2]++;cov_1cwivwlmv().s[17]++;if(!validPassword){cov_1cwivwlmv().b[3][0]++;cov_1cwivwlmv().s[18]++;throw new NotAllowedError(`wrong credentials`);}else{cov_1cwivwlmv().b[3][1]++;}cov_1cwivwlmv().s[19]++;return User.findByIdAndUpdate(id,{$set:data});}).then(()=>{cov_1cwivwlmv().f[3]++;cov_1cwivwlmv().s[20]++;if(typeof newPassword!=='undefined'){cov_1cwivwlmv().b[4][0]++;cov_1cwivwlmv().s[21]++;return bcrypt.hash(newPassword,10).then(newPass=>{cov_1cwivwlmv().f[4]++;cov_1cwivwlmv().s[22]++;return User.findByIdAndUpdate(id,{$set:{newPassword:newPass}});}).then(()=>{cov_1cwivwlmv().f[5]++;cov_1cwivwlmv().s[23]++;return User.findById(id);}).then(user=>{cov_1cwivwlmv().f[6]++;cov_1cwivwlmv().s[24]++;delete user.password;cov_1cwivwlmv().s[25]++;user.password=user.newPassword;cov_1cwivwlmv().s[26]++;delete user.newPassword;cov_1cwivwlmv().s[27]++;return user.save();}).then(()=>{cov_1cwivwlmv().f[7]++;});}else{cov_1cwivwlmv().b[4][1]++;}});});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVwZGF0ZS11c2VyLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlVzZXIiLCJOb3RBbGxvd2VkRXJyb3IiLCJOb3RGb3VuZEVycm9yIiwiYmNyeXB0IiwibW9kdWxlIiwiZXhwb3J0cyIsImlkIiwiZGF0YSIsInBhc3N3b3JkIiwic3RyaW5nIiwidHlwZSIsIk9iamVjdCIsIm5ld1Bhc3N3b3JkIiwiZmluZEJ5SWQiLCJ0aGVuIiwidXNlciIsImRlYWN0aXZhdGVkIiwiY29tcGFyZSIsInZhbGlkUGFzc3dvcmQiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRzZXQiLCJoYXNoIiwibmV3UGFzcyIsInNhdmUiXSwibWFwcGluZ3MiOiJtdUpBQUEsS0FBTSxDQUFFQSxRQUFGLDBCQUFlQyxPQUFPLENBQUMsaUJBQUQsQ0FBdEIsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBViwwQkFBdUJGLE9BQU8sQ0FBQyxnQkFBRCxDQUE5QixDQUFOLENBQ0EsS0FBTSxDQUFFRyxlQUFGLENBQW1CQyxhQUFuQiwwQkFBcUNKLE9BQU8sQ0FBQyxrQkFBRCxDQUE1QyxDQUFOLENBQ0EsS0FBTUssQ0FBQUEsTUFBTSx5QkFBR0wsT0FBTyxDQUFDLFVBQUQsQ0FBVixDQUFaLENBRUE7Ozs7Ozs7Ozs7OzBCQWFBTSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsRUFBRCxDQUFLQyxJQUFMLENBQVdDLFFBQVgsR0FBd0IsK0NBQ3JDWCxRQUFRLENBQUNZLE1BQVQsQ0FBZ0JILEVBQWhCLENBQW9CLElBQXBCLEVBRHFDLHVCQUVyQ1QsUUFBUSxDQUFDYSxJQUFULENBQWNILElBQWQsQ0FBb0IsTUFBcEIsQ0FBNEJJLE1BQTVCLEVBRnFDLHVCQUdyQ2QsUUFBUSxDQUFDWSxNQUFULENBQWdCRCxRQUFoQixDQUEwQixVQUExQixFQUVBLEtBQU0sQ0FBRUksV0FBRiwwQkFBa0JMLElBQWxCLENBQU4sQ0FMcUMsdUJBT3JDLEdBQUksTUFBT0ssQ0FBQUEsV0FBUCxHQUF1QixXQUEzQixDQUF3QyxtREFDcENmLFFBQVEsQ0FBQ1ksTUFBVCxDQUFnQkcsV0FBaEIsQ0FBNkIsYUFBN0IsRUFDSCxDQUZELGdDQVBxQyx3QkFXckMsTUFBT1osQ0FBQUEsSUFBSSxDQUFDYSxRQUFMLENBQWNQLEVBQWQsRUFDRlEsSUFERSxDQUNHQyxJQUFJLEVBQUksZ0RBQ1YsR0FBSSxDQUFDQSxJQUFMLENBQVcsd0RBQU0sSUFBSWIsQ0FBQUEsYUFBSixDQUFtQixnQkFBZUksRUFBRyxpQkFBckMsQ0FBTixDQUE0RCxDQUF2RSxnQ0FEVSx3QkFFVixHQUFJUyxJQUFJLENBQUNDLFdBQVQsQ0FBc0Isd0RBQU0sSUFBSWYsQ0FBQUEsZUFBSixDQUFxQixnQkFBZUssRUFBRyxpQkFBdkMsQ0FBTixDQUE4RCxDQUFwRixnQ0FGVSx3QkFJVixNQUFPSCxDQUFBQSxNQUFNLENBQUNjLE9BQVAsQ0FBZVQsUUFBZixDQUF5Qk8sSUFBSSxDQUFDUCxRQUE5QixFQUNGTSxJQURFLENBQ0dJLGFBQWEsRUFBSSxnREFDbkIsR0FBSSxDQUFDQSxhQUFMLENBQW9CLHdEQUFNLElBQUlqQixDQUFBQSxlQUFKLENBQXFCLG1CQUFyQixDQUFOLENBQThDLENBQWxFLGdDQURtQix3QkFHbkIsTUFBT0QsQ0FBQUEsSUFBSSxDQUFDbUIsaUJBQUwsQ0FBdUJiLEVBQXZCLENBQTJCLENBQUVjLElBQUksQ0FBRWIsSUFBUixDQUEzQixDQUFQLENBQ0gsQ0FMRSxFQU1GTyxJQU5FLENBTUcsSUFBTSxnREFDUixHQUFJLE1BQU9GLENBQUFBLFdBQVAsR0FBdUIsV0FBM0IsQ0FBd0MsbURBQ3BDLE1BQU9ULENBQUFBLE1BQU0sQ0FBQ2tCLElBQVAsQ0FBWVQsV0FBWixDQUF5QixFQUF6QixFQUNGRSxJQURFLENBQ0dRLE9BQU8sRUFBSSxzREFBQXRCLENBQUFBLElBQUksQ0FBQ21CLGlCQUFMLENBQXVCYixFQUF2QixDQUEyQixDQUFFYyxJQUFJLENBQUUsQ0FBRVIsV0FBVyxDQUFFVSxPQUFmLENBQVIsQ0FBM0IsRUFBOEQsQ0FENUUsRUFFRlIsSUFGRSxDQUVHLElBQU0sc0RBQUFkLENBQUFBLElBQUksQ0FBQ2EsUUFBTCxDQUFjUCxFQUFkLEVBQWlCLENBRjFCLEVBR0ZRLElBSEUsQ0FHR0MsSUFBSSxFQUFJLGdEQUNWLE1BQU9BLENBQUFBLElBQUksQ0FBQ1AsUUFBWixDQURVLHdCQUVWTyxJQUFJLENBQUNQLFFBQUwsQ0FBZ0JPLElBQUksQ0FBQ0gsV0FBckIsQ0FGVSx3QkFHVixNQUFPRyxDQUFBQSxJQUFJLENBQUNILFdBQVosQ0FIVSx3QkFLVixNQUFPRyxDQUFBQSxJQUFJLENBQUNRLElBQUwsRUFBUCxDQUNILENBVEUsRUFVRlQsSUFWRSxDQVVHLElBQU0sd0JBQUcsQ0FWWixDQUFQLENBV0gsQ0FaRCxnQ0FhSCxDQXBCRSxDQUFQLENBcUJILENBMUJFLENBQVAsQ0EyQkgsQ0F0Q0QiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHZhbGlkYXRlIH0gPSByZXF1aXJlKCdwb29waW5pb24tdXRpbHMnKVxyXG5jb25zdCB7IG1vZGVsczogeyBVc2VyIH0gfSA9IHJlcXVpcmUoJ3Bvb3Bpbmlvbi1kYXRhJylcclxuY29uc3QgeyBOb3RBbGxvd2VkRXJyb3IsIE5vdEZvdW5kRXJyb3IgfSA9IHJlcXVpcmUoJ3Bvb3Bpbmlvbi1lcnJvcnMnKVxyXG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHRqcycpXHJcblxyXG4vKipcclxuICogVXBkYXRlcyB0aGUgdXNlcidzIGluZm9cclxuICogXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZCB1c2VyJ3MgdW5pcXVlIElEXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIHRoZSBlbGVtZW50cyB0aGF0IHdpbGwgYmUgdXBkYXRlZFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGFzc3dvcmQgdXNlcidzIHBhc3N3b3JkXHJcbiAqIFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSBhbiBlbXB0eSBQcm9taXNlIG9uIGEgc3VjY2Vzc2Z1bCB1cGRhdGVcclxuICogXHJcbiAqIEB0aHJvd3Mge05vdEFsbG93ZWRFcnJvcn0gaWYgYSB1c2VyIHNldCBhIHdyb25nIHBhc3N3b3JkXHJcbiAqIEB0aHJvd3Mge05vdEZvdW5kRXJyb3J9IGlmIHRoZSB1c2VyIGRvZXMgbm90IGV4aXN0XHJcbiAqL1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSAoaWQsIGRhdGEsIHBhc3N3b3JkKSA9PiB7XHJcbiAgICB2YWxpZGF0ZS5zdHJpbmcoaWQsICdpZCcpXHJcbiAgICB2YWxpZGF0ZS50eXBlKGRhdGEsICdkYXRhJywgT2JqZWN0KVxyXG4gICAgdmFsaWRhdGUuc3RyaW5nKHBhc3N3b3JkLCAncGFzc3dvcmQnKVxyXG5cclxuICAgIGNvbnN0IHsgbmV3UGFzc3dvcmQgfSA9IGRhdGFcclxuXHJcbiAgICBpZiAodHlwZW9mIG5ld1Bhc3N3b3JkICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHZhbGlkYXRlLnN0cmluZyhuZXdQYXNzd29yZCwgJ25ld1Bhc3N3b3JkJylcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gVXNlci5maW5kQnlJZChpZClcclxuICAgICAgICAudGhlbih1c2VyID0+IHtcclxuICAgICAgICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcihgdXNlciB3aXRoIGlkICR7aWR9IGRvZXMgbm90IGV4aXN0YClcclxuICAgICAgICAgICAgaWYgKHVzZXIuZGVhY3RpdmF0ZWQpIHRocm93IG5ldyBOb3RBbGxvd2VkRXJyb3IoYHVzZXIgd2l0aCBpZCAke2lkfSBpcyBkZWFjdGl2YXRlZGApXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAudGhlbih2YWxpZFBhc3N3b3JkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbGlkUGFzc3dvcmQpIHRocm93IG5ldyBOb3RBbGxvd2VkRXJyb3IoYHdyb25nIGNyZWRlbnRpYWxzYClcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFVzZXIuZmluZEJ5SWRBbmRVcGRhdGUoaWQsIHsgJHNldDogZGF0YSB9KVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG5ld1Bhc3N3b3JkICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmNyeXB0Lmhhc2gobmV3UGFzc3dvcmQsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obmV3UGFzcyA9PiBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKGlkLCB7ICRzZXQ6IHsgbmV3UGFzc3dvcmQ6IG5ld1Bhc3MgfSB9KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IFVzZXIuZmluZEJ5SWQoaWQpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4odXNlciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHVzZXIucGFzc3dvcmRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyLnBhc3N3b3JkID0gdXNlci5uZXdQYXNzd29yZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB1c2VyLm5ld1Bhc3N3b3JkXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyLnNhdmUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsgfSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbn0iXX0=